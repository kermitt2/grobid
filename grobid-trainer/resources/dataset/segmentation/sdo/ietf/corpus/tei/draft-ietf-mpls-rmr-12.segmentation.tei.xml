<?xml version="1.0" ?>
<tei xml:space="preserve">
	<teiHeader>
		<fileDesc xml:id="0"/>
	</teiHeader>
	<text xml:lang="en">
			<front>
				MPLS WG <lb/>K. Kompella <lb/>Internet-Draft <lb/>Juniper Networks, Inc. <lb/>Intended status: Standards Track <lb/>L. Contreras <lb/>Expires: April 25, 2020 <lb/>Telefonica <lb/>October 23, 2019 <lb/>Resilient MPLS Rings <lb/>draft-ietf-mpls-rmr-12 <lb/>Abstract <lb/>This document describes the use of the MPLS control and data planes <lb/>on ring topologies. It describes the special nature of rings, and <lb/>proceeds to show how MPLS can be effectively used in such topologies. <lb/>It describes how MPLS rings are configured, auto-discovered and <lb/>signaled, as well as how the data plane works. Companion documents <lb/>describe the details of discovery and signaling for specific <lb/>protocols. <lb/>Requirements Language <lb/>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, <lb/>&quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this <lb/>document are to be interpreted as described in [RFC2119]. <lb/>Status of This Memo <lb/>This Internet-Draft is submitted in full conformance with the <lb/>provisions of BCP 78 and BCP 79. <lb/>Internet-Drafts are working documents of the Internet Engineering <lb/>Task Force (IETF). Note that other groups may also distribute <lb/>working documents as Internet-Drafts. The list of current Internet-<lb/>Drafts is at https://datatracker.ietf.org/drafts/current/. <lb/>Internet-Drafts are draft documents valid for a maximum of six months <lb/>and may be updated, replaced, or obsoleted by other documents at any <lb/>time. It is inappropriate to use Internet-Drafts as reference <lb/>material or to cite them other than as &quot;work in progress.&quot; <lb/>This Internet-Draft will expire on April 25, 2020. <lb/>Copyright Notice <lb/>Copyright (c) 2019 IETF Trust and the persons identified as the <lb/>document authors. All rights reserved. <lb/>Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/>[Page 1] <lb/>Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/>This document is subject to BCP 78 and the IETF Trust&apos;s Legal <lb/>Provisions Relating to IETF Documents <lb/>(https://trustee.ietf.org/license-info) in effect on the date of <lb/>publication of this document. Please review these documents <lb/>carefully, as they describe your rights and restrictions with respect <lb/>to this document. Code Components extracted from this document must <lb/>include Simplified BSD License text as described in Section 4.e of <lb/>the Trust Legal Provisions and are provided without warranty as <lb/>described in the Simplified BSD License. <lb/>
			</front>
			
			<div type="toc">
				Table of Contents <lb/>1. Introduction . . . . . . . . . . . . . . . . . . . . . . . . <lb/>2 <lb/>1.1. Definitions . . . . . . . . . . . . . . . . . . . . . . . <lb/>3 <lb/>2. Motivation . . . . . . . . . . . . . . . . . . . . . . . . . <lb/>5 <lb/>3. Theory of Operation . . . . . . . . . . . . . . . . . . . . . <lb/>5 <lb/>3.1. Provisioning . . . . . . . . . . . . . . . . . . . . . . <lb/>5 <lb/>3.2. Ring Nodes . . . . . . . . . . . . . . . . . . . . . . . <lb/>6 <lb/>3.3. Ring Links and Directions . . . . . . . . . . . . . . . . <lb/>6 <lb/>3.3.1. Express Links . . . . . . . . . . . . . . . . . . . . <lb/>6 <lb/>3.4. Ring LSPs . . . . . . . . . . . . . . . . . . . . . . . . <lb/>7 <lb/>3.5. Installing Primary LFIB Entries . . . . . . . . . . . . . <lb/>7 <lb/>3.6. Protection . . . . . . . . . . . . . . . . . . . . . . . <lb/>7 <lb/>3.7. Installing FRR LFIB Entries . . . . . . . . . . . . . . . <lb/>8 <lb/>4. Autodiscovery . . . . . . . . . . . . . . . . . . . . . . . . <lb/>9 <lb/>4.1. Overview . . . . . . . . . . . . . . . . . . . . . . . . <lb/>9 <lb/>4.2. Ring Announcement Phase . . . . . . . . . . . . . . . . . 10 <lb/>4.3. Mastership Phase . . . . . . . . . . . . . . . . . . . . 11 <lb/>4.4. Ring Identification Phase . . . . . . . . . . . . . . . . 11 <lb/>4.5. Ring Changes . . . . . . . . . . . . . . . . . . . . . . 12 <lb/>5. Ring OAM . . . . . . . . . . . . . . . . . . . . . . . . . . 13 <lb/>6. Advanced Topics . . . . . . . . . . . . . . . . . . . . . . . 13 <lb/>6.1. Half-rings . . . . . . . . . . . . . . . . . . . . . . . 13 <lb/>6.2. Hub Node Resilience . . . . . . . . . . . . . . . . . . . 13 <lb/>7. Security Considerations . . . . . . . . . . . . . . . . . . . 14 <lb/>8. Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . 14 <lb/>9. IANA Considerations . . . . . . . . . . . . . . . . . . . . . 14 <lb/>10. References . . . . . . . . . . . . . . . . . . . . . . . . . 14 <lb/>10.1. Normative References . . . . . . . . . . . . . . . . . . 14 <lb/>10.2. Informative References . . . . . . . . . . . . . . . . . 14 <lb/>Authors&apos; Addresses . . . . . . . . . . . . . . . . . . . . . . . 15 <lb/>
			</div>

			<body>
				1. Introduction <lb/>Rings are a very common topology in transport networks. A ring is <lb/>the simplest topology offering link and node resilience. Rings are <lb/>nearly ubiquitous in access and aggregation networks. As MPLS <lb/>increases its presence in such networks, and takes on a greater role <lb/></body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 2] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				in transport, it is imperative that MPLS handles rings well; this is <lb/>not the case today. <lb/>This document describes the special nature of rings, and the special <lb/>needs of MPLS on rings. It then shows how these needs can be met in <lb/>several ways, some of which involve extensions to protocols such as <lb/>IS-IS [RFC5305], OSPF[RFC3630], RSVP-TE [RFC3209] and LDP [RFC5036]. <lb/>RMR LSPs can also be signaled with SPRING [RFC8402]; that will be <lb/>described in a future document. <lb/>The intent of this document is to handle rings that &quot;occur <lb/>naturally&quot;. Many access and aggregation networks in metros have <lb/>their start as a simple ring. They may then grow into more complex <lb/>topologies, for example, by adding parallel links to the ring, or by <lb/>adding &quot;express&quot; links. The goal here is to discover these rings <lb/>(with some guidance), and run MPLS over them efficiently. The intent <lb/>is not to construct rings in a mesh network, and use those for <lb/>protection. <lb/>1.1. Definitions <lb/>A (directed) graph G = (V, E) consists of a set of vertices (or <lb/>nodes) V and a set of edges (or links) E. An edge is an ordered pair <lb/>of nodes (a, b), where a and b are in V. (In this document, the <lb/>terms node and link will be used instead of vertex and edge.) <lb/>A ring is a subgraph of G. A ring consists of a subset of n nodes <lb/>{R_i, 0 &lt;= i &lt; n} of V. The directed edges {(R_i, R_i+1) and (R_i+1, <lb/>R_i), 0 &lt;= i &lt; n-1} must be a subset of E (note that index arithmetic <lb/>is done modulo n). We define the direction from node R_i to R_i+1 as <lb/>&quot;clockwise&quot; (CW) and the reverse direction as &quot;anticlockwise&quot; (AC). <lb/>As there may be several rings in a graph, we number each ring with a <lb/>distinct ring ID RID. <lb/>R0 . . . R1 <lb/>. <lb/>. <lb/>R7 <lb/>R2 <lb/>Anti-<lb/>| . <lb/>Ring <lb/>. | <lb/>Clockwise | . <lb/>. | Clockwise <lb/>v . <lb/>RID = 17 <lb/>. v <lb/>R6 <lb/>R3 <lb/>. <lb/>. <lb/>R5 . . . R4 <lb/>Figure 1: Ring with 8 nodes <lb/>The following terminology is used for ring LSPs: <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 3] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				Ring ID (RID): A non-negative number. When the RID identifies a <lb/>ring, it must be positive and unique in some scope of a Service <lb/>Provider&apos;s network. An RID of zero, when assigned to a node, <lb/>indicates that the node must behave in &quot;promiscuous mode&quot; (see <lb/>Section 3.2). A node may belong to multiple rings. <lb/>Ring node: A member of a ring. Note that a device may belong to <lb/>several rings. <lb/>Node index: A logical numbering of nodes in a ring, from zero up to <lb/>one less than the ring size. Used purely for exposition in this <lb/>document. <lb/>Ring master: The ring master initiates the ring identification <lb/>process. Mastership is indicated in the IGP by a two-bit field. <lb/>Ring neighbors: Nodes whose indices differ by one (modulo ring <lb/>size). <lb/>Ring links: Links that connect ring neighbors. <lb/>Express links: Links that connect non-neighboring ring nodes. <lb/>Ring direction: A two-bit field in the IGP indicating the direction <lb/>of a link. The choices are: <lb/>UN: 00 undefined link <lb/>CW: 01 clockwise ring link <lb/>AC: 10 anticlockwise ring link <lb/>EX: 11 express link <lb/>Ring Identification: The process of discovering ring nodes, ring <lb/>links, link directions, and express links. <lb/>The following notation is used for ring LSPs: <lb/>R_k: A ring node with index k. R_k has AC neighbor R_(k-1) and CW <lb/>neighbor R_(k+1). <lb/>RL_k: A (unicast) Ring LSP anchored on node R_k. <lb/>CL_jk: A label allocated by R_j for RL_k in the CW direction. <lb/>AL_jk: A label allocated by R_j for RL_k in the AC direction. <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 4] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				2. Motivation <lb/>A ring is the simplest topology that offers resilience. This is <lb/>perhaps the main reason to lay out fiber in a ring. Thus, effective <lb/>mechanisms for fast failover on rings are needed. Furthermore, there <lb/>are large numbers of rings. Thus, configuration of rings needs to be <lb/>as simple as possible. Finally, bandwidth management on access rings <lb/>is very important, as bandwidth is generally quite constrained here. <lb/>The goals of this document are to present mechanisms for improved <lb/>MPLS-based resilience in ring networks (using ideas that are <lb/>reminiscent of Bidirectional Line Switched Rings), for automatic <lb/>bring-up of LSPs, better bandwidth management and for auto-hierarchy. <lb/>These goals can be achieved using extensions to existing IGP and MPLS <lb/>signaling protocols, using central provisioning, or in other ways. <lb/>3. Theory of Operation <lb/>Say a ring has ring ID RID. The ring is provisioned by choosing one <lb/>or more ring masters for the ring and assigning them the RID. Other <lb/>nodes in the ring may also be assigned this RID, or may be configured <lb/>as &quot;promiscuous&quot;. Ring discovery then kicks in. When each ring node <lb/>knows its CW and AC ring neighbors and its ring links, and all <lb/>express links have been identified, ring identification is complete. <lb/>Once ring identification is complete, each node signals one or more <lb/>ring LSPs RL_i. RL_i, anchored on node R_i, consists of two counter-<lb/>rotating unicast LSPs that start and end at R_i. A ring LSP is <lb/>&quot;multipoint&quot;: any node R_j can use RL_i to send traffic to R_i; this <lb/>can be in either the CW or AC directions, or both (i.e., load <lb/>balanced). Both of these counter-rotating LSPs are &quot;active&quot;; the <lb/>choice of direction to send traffic to R_i is determined by policy at <lb/>the node where traffic is injected into the ring. The default policy <lb/>is to send traffic along the shortest path. Bidirectional <lb/>connectivity between nodes R_i and R_j is achieved by using two <lb/>different ring LSPs: R_i uses RL_j to reach R_j, and R_j uses RL_i to <lb/>reach R_i. <lb/>3.1. Provisioning <lb/>The goal here is to provision rings with the absolute minimum <lb/>configuration. The exposition below aims to achieve that using auto-<lb/>discovery via a link-state IGP (see Section 4). Of course, auto-<lb/>discovery can be overriden by configuration. For example, a link <lb/>that would otherwise be classified by auto-discovery as a ring link <lb/>might be configured not to be used for ring LSPs. <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 5] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				3.2. Ring Nodes <lb/>Ring nodes have a loopback address, and run a link-state IGP and an <lb/>MPLS signaling protocol. To provision a node as a ring node for ring <lb/>RID, the node is simply assigned that RID. A node may be part of <lb/>several rings, and thus may be assigned several ring IDs. <lb/>To simplify ring provisioning even further, a node N may be made <lb/>&quot;promiscuous&quot; by being assigned an RID of 0. A promiscuous node <lb/>listens to RIDs in its IGP neighbors&apos; link-state updates. For every <lb/>non-zero RID N hears from a neighbor, N joins the corresponding ring <lb/>by taking on that RID. In many situations, the use of promiscuous <lb/>mode means that only one or two nodes in a ring needs to be <lb/>provisioned; everything else is auto-discovered. <lb/>A ring node indicates in its IGP updates the ring LSP signaling <lb/>protocols it supports. This can be LDP and/or RSVP-TE. Ideally, <lb/>each node should support both. <lb/>3.3. Ring Links and Directions <lb/>Ring links must be MPLS-capable. They are by default unnumbered, <lb/>point-to-point (from the IGP point of view) and &quot;auto-bundled&quot;. The <lb/>&quot;auto-bundled&quot; attribute means that parallel links between ring <lb/>neighbors are considered as a single link, without the need for <lb/>explicit configuration for bundling (such as a Link Aggregation <lb/>Group). Note that each component may be advertised separately in the <lb/>IGP; however, signaling messages and labels across one component link <lb/>apply to all components. Parallel links between a pair of ring nodes <lb/>is often the result of having multiple lambdas or fibers between <lb/>those nodes. RMR is primarily intended for operation at the packet <lb/>layer; however, parallel links at the lambda or fiber layer may <lb/>result in parallel links at the packet layer. <lb/>A ring link is not provisioned as belonging to the ring; it is <lb/>discovered to belong to ring RID if both its adjacent nodes belong to <lb/>RID. A ring link&apos;s direction (CW or AC) is also discovered; this <lb/>process is initiated by the ring&apos;s ring master. Note that the above <lb/>two attributes can be overridden by provisioning if needed; it is <lb/>then up to the provisioning system to maintain consistency across the <lb/>ring. <lb/>3.3.1. Express Links <lb/>Express links are discovered once ring nodes, ring links and <lb/>directions have been established. As defined earlier, express links <lb/>are links joining non-neighboring ring nodes; often, this may be the <lb/>result of optically bypassing ring nodes. <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 6] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				3.4. Ring LSPs <lb/>Ring LSPs are not provisioned. Once a ring node R_i knows its RID, <lb/>its ring links and directions, it kicks off ring LSP signaling <lb/>automatically. R_i allocates CW and AC labels for each ring LSP <lb/>RL_k. R_i also initiates the creation of RL_i. As the signaling <lb/>propagates around the ring, CW and AC labels are exchanged. When R_i <lb/>receives CW and AC labels for RL_k from its ring neighbors, primary <lb/>and fast reroute (FRR) paths for RL_k are installed at R_i. <lb/>For RSVP-TE LSPs, bandwidths may be signaled in both directions. <lb/>However, these are not provisioned either; rather, one does &quot;reverse <lb/>call admission control&quot;. When a service needs to use an LSP, the <lb/>ring node where the traffic enters the ring attempts to increase the <lb/>bandwidth on the LSP to the egress. If successful, the service is <lb/>admitted to the ring. <lb/>3.5. Installing Primary LFIB Entries <lb/>In setting up RL_k, a node R_j sends out two labels: CL_jk to R_j-1 <lb/>and AL_jk to R_j+1. R_j also receives two labels: CL_j+1,k from <lb/>R_j+1, and AL_j-1,k from R_j-1. R_j can now set up the forwarding <lb/>entries for RL_k. In the CW direction, R_j swaps incoming label <lb/>CL_jk with CL_j+1,k with next hop R_j+1; these allow R_j to act as <lb/>LSR for RL_k. R_j also installs an LFIB entry to push CL_j+1,k with <lb/>next hop R_j+1 to act as ingress for RL_k. Similarly, in the AC <lb/>direction, R_j swaps incoming label AL_jk with AL_j-1,k with next hop <lb/>R_j-1 (as LSR), and an entry to push AL_j-1,k with next hop R_j-1 (as <lb/>ingress). <lb/>Clearly, R_k does not act as ingress for its own LSPs. However, R_k <lb/>can send OAM messages, for example, an MPLS ping or traceroute <lb/>([I-D.ietf-mpls-rfc4379bis]), using labels CL_k,k+1 and AL_k-1,k, to <lb/>test the entire ring LSP anchored at R_k in both directions. <lb/>Furthermore, if these LSPs use Ultimate Hop Popping, then R_k <lb/>installs LFIB entries to pop CL_k,k for packets received from R_k-1 <lb/>and to pop AL_k,k for packets received from R_k+1. <lb/>3.6. Protection <lb/>In this scheme, there are no protection LSPs as such --no node or <lb/>link bypass LSPs, no standby LSPs, no detours, and no LFA-type <lb/>protection. Protection is via the &quot;other&quot; direction around the ring, <lb/>which is why ring LSPs are in counter-rotating pairs. Protection <lb/>works in the same way for link, node and ring LSP failures. <lb/>If a node R_j detects a failure from R_j+1 --either all links to <lb/>R_j+1 fail, or R_j+1 itself fails, R_j switches traffic on all CW <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 7] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				ring LSPs to the AC direction using the FRR LFIB entries. If the <lb/>failure is specific to a single ring LSP, R_j switches traffic just <lb/>for that LSP. In either case, this switchover can be very fast, as <lb/>the FRR LFIB entries can be preprogrammed. Fast detection and fast <lb/>switchover lead to minimal traffic loss. <lb/>R_j then sends an indication to R_j-1 that the CW direction is not <lb/>working, so that R_j-1 can similarly switch traffic to the AC <lb/>direction. For RSVP-TE, this indication can be a PathErr or a <lb/>Notify; other signaling protocols have similar indications. These <lb/>indications propagate AC until each traffic source on the ring AC of <lb/>the failure uses the AC direction. Thus, within a short period, <lb/>traffic will be flowing in the optimal path, given that there is a <lb/>failure on the ring. This contrasts with (say) bypass protection, <lb/>where until the ingress recomputes a new path, traffic will be <lb/>suboptimal. <lb/>Note that the failure of a node or a link will not necessarily affect <lb/>all ring LSPs. Thus, it is important to identify the affected LSPs <lb/>(and switch them), but to leave the rest alone. <lb/>One point to note is that when a ring node, say R_j, fails, RL_j is <lb/>clearly unusable. However, the above protection scheme will cause a <lb/>traffic loop: R_j-1 detects a failure CW, and protects by sending CW <lb/>traffic on RL_j back all the way to R_j+1, which in turn sends <lb/>traffic to R_j-1, etc. There are three proposals to avoid this: <lb/>1. Each ring node acting as ingress sends traffic with a TTL of at <lb/>most 2*n, where n is the number of nodes in the ring. <lb/>2. A ring node sends protected traffic (i.e., traffic switched from <lb/>CW to AC or vice versa) with TTL just large enough to reach the <lb/>egress. <lb/>3. A ring node sends protected traffic with a special purpose label <lb/>below the ring LSP label. A protecting node first checks for the <lb/>presence of this label; if present, it means that the traffic is <lb/>looping and MUST be dropped. <lb/>It is recommended that (2) be implemented. The other methods are <lb/>optional. <lb/>3.7. Installing FRR LFIB Entries <lb/>At the same time that R_j sets up its primary CW and AC LFIB entries, <lb/>it can also set up the protection forwarding entries for RL_k. In <lb/>the CW direction, R_j sets up an FRR LFIB entry to swap incoming <lb/>label CL_jk with AL_j-1,k with next hop R_j-1. In the AC direction, <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 8] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				R_j sets up an FRR LFIB entry to swap incoming label AL_jk with <lb/>CL_j+1,k with next hop R_j+1. Again, R_k does not install FRR LFIB <lb/>entries in this manner. <lb/>Say R1 receives label L42 from R2 to reach R4 in the clockwise <lb/>direction, and receives label L40 from R0 to reach R4 in the anti-<lb/>clockwise direction. Say R1 also receives label L52 from R2 to reach <lb/>R5 in the clockwise direction, and receives label L50 from R0 to <lb/>reach R5 in the anti-clockwise direction. R1 makes the following <lb/>LFIB entries: <lb/>+------+--------+-----------+--------+-----------+ <lb/>| Dest | CW/NH | CW FRR/NH | AC/NH | AC FRR/NH | <lb/>+------+--------+-----------+--------+-----------+ <lb/>| ... | <lb/>| <lb/>| <lb/>| <lb/>| <lb/>| R4 <lb/>| L42/R2 | <lb/>L40/R0 | L40/R0 | <lb/>L42/R2 | <lb/>| R5 <lb/>| L52/R2 | <lb/>L50/R0 | L50/R0 | <lb/>L52/R2 | <lb/>| ... | <lb/>| <lb/>| <lb/>| <lb/>| <lb/>+------+--------+-----------+--------+-----------+ <lb/>R1&apos;s LFIB <lb/>4. Autodiscovery <lb/>4.1. Overview <lb/>Auto-discovery proceeds in three phases. The first phase is the <lb/>announcement phase. The second phase is the mastership phase. The <lb/>third phase is the ring identification phase. <lb/>S1 <lb/>/ <lb/>\ <lb/>| <lb/>R0 . . . R1 <lb/>R0 has MV = 11 <lb/>| . <lb/>\ <lb/>. <lb/>R1 has MV = 10 <lb/>R7 <lb/>\________ R2 <lb/>All other nodes have MV = 00 <lb/>Anti-<lb/>| . <lb/>. | <lb/>clockwise | . <lb/>Ring <lb/>. | Clockwise <lb/>v . <lb/>RID = 17 <lb/>. v <lb/>R6 <lb/>R3 <lb/>. <lb/>. <lb/>R5 . . . R4 <lb/>\ <lb/>/ <lb/>\ <lb/>/ <lb/>An <lb/>Figure 2: Ring with non-ring nodes and links <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 9] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				The format of an RMR Node Type-Length-Value (TLV) is given below. It <lb/>consists of information pertaining to the node and optionally, sub-<lb/>TLVs. A Neighbor sub-TLV contains information pertaining to the <lb/>node&apos;s neighbors. Other sub-TLVs may be defined in the future. <lb/>Details of the format specific to IS-IS and OSPF will be given in the <lb/>corresponding IGP documents. <lb/>[RMR Node Type][RMR Node Length][RID][Node Flags][sub-TLVs] <lb/>Ring Node TLV Format <lb/>[RMR Nbr Type][RMR Nbr Length][Nbr Address][Nbr Flags] <lb/>Ring Neighbor Sub-TLV Format <lb/>0 <lb/>1 <lb/>0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 <lb/>+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <lb/>|MV | SS | SO | MBZ <lb/>|SU |M| <lb/>+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <lb/>MV: Mastership Value <lb/>SS: Supported Signaling Protocols <lb/>(100 = RSVP-TE; 010 = LDP; 001 = SPRING) <lb/>MBZ: Must be zero <lb/>SO: Supported OAM Protocols (100 = BFD; 010 = CFM; 001 = EFM) <lb/>SU: Signaling Protocol to Use (00 = none; 01 = LDP; 10 = RSVP-TE) <lb/>M : Elected Master (0 = no, 1 = yes) <lb/>Flags for a Ring Node TLV <lb/>0 <lb/>1 <lb/>0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 <lb/>+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <lb/>|RD |OAM| <lb/>MBZ <lb/>| <lb/>+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <lb/>RD: Ring Direction <lb/>OAM: OAM Protocol to use (00 = none; 01 = BFD; 10 = CFM; 11 = EFM) <lb/>MBZ: Must be zero <lb/>Flags for a Ring Neighbor TLV <lb/>4.2. Ring Announcement Phase <lb/>Each node participating in an MPLS ring is assigned an RID; in the <lb/>example, RID = 17. A node is also provisioned with a mastership <lb/>value. Each node advertises a ring node TLV for each ring it is <lb/>participating in, along with the associated flags. It then starts <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 10] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				timer T1; this timer is to allow each node time to hear from all <lb/>other nodes in the ring. <lb/>A node in promiscuous mode doesn&apos;t advertise any ring node TLVs. <lb/>However, when it hears a ring node TLV from an IGP neighbor, it joins <lb/>that ring, and sends its own ring node TLV with that RID. <lb/>The announcement phase allows a ring node to discover other ring <lb/>nodes in the same ring so that a ring master can be elected. <lb/>4.3. Mastership Phase <lb/>When timer T1 fires, a node enters the mastership phase. In this <lb/>phase, each ring node N starts timer T2 and checks if it is master. <lb/>If it is the node with the lowest loopback address of all nodes with <lb/>the highest mastership values, N declares itself master by <lb/>readvertising its ring node TLV with the M bit set. <lb/>When timer T2 fires, each node examines the ring node TLVs from all <lb/>other nodes in the ring to identify the ring master. There should be <lb/>exactly one; if not, each node restarts timer T2 and tries again. <lb/>Barring software bugs or malicious code, the principal reason for <lb/>multiple nodes for setting their M bit is late-arriving ring <lb/>announcements. Say nodes N1 and N2 have the highest mastership <lb/>values, and N1 has the lowest loopback address, while N2 has the <lb/>second lowest loopback address. If N1 makes its ring announcement <lb/>just as N2&apos;s T1 timer fires, both N1 and N2 will think they are the <lb/>master (since N2 will not have heard N1&apos;s announcment in time). <lb/>However, in the next round, N2 will realize that N1 is indeed the <lb/>master. In the worst case, the mastership phase will occur as many <lb/>times as there are nodes in the ring. <lb/>4.4. Ring Identification Phase <lb/>R0 . . . R1 <lb/>&lt;------3. Anti-clockwise neighbor <lb/>. <lb/>. <lb/>R7 <lb/>R2 &lt;---0. Ring Master <lb/>. <lb/>Ring <lb/>/ . <lb/>. <lb/>/ . <lb/>1. Maximal ring includes R3 <lb/>. <lb/>/ <lb/>. <lb/>R6 <lb/>/ <lb/>R3 &lt;---2. Clockwise neighbor <lb/>. <lb/>/ . <lb/>R5 . . . R4 <lb/>&lt;------4. R4 is express neighbor <lb/>Figure 3: Ring Identification <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 11] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				When there is exactly one ring master M (here, R2), M enters the Ring <lb/>Identification Phase. M indicates that it has successfully completed <lb/>this phase by advertising ring link TLVs. This is the trigger for <lb/>M&apos;s CW neighbor to enter the Ring Identification Phase. This phase <lb/>passes CW until all ring nodes have completed ring identification. <lb/>In the Ring Identification Phase, a node X that has two or more IGP <lb/>neighbors that belong to the ring picks one of them to be its CW ring <lb/>neighbor. If X is the ring master, it also picks a node as its AC <lb/>ring neighbor. If there are exactly two such nodes, this step is <lb/>trivial. If not, X computes a ring that includes all nodes that have <lb/>completed the Ring Identification Phase (as seen by their ring link <lb/>TLVs) and further contains the maximal number of nodes that belong to <lb/>the ring. Based on that, X picks a CW neighbor and inserts ring link <lb/>TLVs with ring direction CW for each link to its CW neighbor; X also <lb/>inserts a ring link TLV with direction AC for each link to its AC <lb/>neighbor. Then, X determines its express links. These are links <lb/>connected to ring nodes that are not ring neighbors. X advertises <lb/>ring link TLVs for express links by setting the link direction to <lb/>&quot;express link&quot;. <lb/>Here, R2 has R1 as its neighbor on one side; it has two choices, R3 <lb/>and R4 on the other. It picks R3 to get a maximal ring (Step 1). It <lb/>then picks R3 as its CW neighbor (Step 2) and R1 as its AC neighbor <lb/>(Step 3). Finally, it declares the link to R4 as an express link. <lb/>4.5. Ring Changes <lb/>The main changes to a ring are: <lb/>ring link addition; <lb/>ring link deletion; <lb/>ring node addition; and <lb/>ring node deletion. <lb/>The main goal of handling ring changes is (as much as possible) not <lb/>to perturb existing ring operation. Thus, if the ring master hasn&apos;t <lb/>changed, all of the above changes should be local to the point of <lb/>change. Link adds just update the IGP; signaling should take <lb/>advantage of the new capacity as soon as it learns. Link deletions <lb/>in the case of parallel links also show up as a change in capacity <lb/>(until the last link in the bundle is removed.) <lb/>The removal of the last ring link between two nodes, or the removal <lb/>of a ring node is an event that triggers protection switching. In a <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 12] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				simple ring, the result is a broken ring. However, if a ring has <lb/>express links, then it may be able to converge to a smaller ring with <lb/>protection. <lb/>The addition of a new ring node can also be handled incrementally. <lb/>5. Ring OAM <lb/>Each ring node should advertise in its ring node TLV the OAM <lb/>protocols it supports. Each ring node is expected to run a link-<lb/>level OAM over each ring link. This should be an OAM protocol that <lb/>both neighbors agree on. The default hello time is 3.3 millisecond. <lb/>Each ring node also sends OAM messages over each direction of its <lb/>ring LSP. This is a multi-hop OAM to check LSP liveness; typically, <lb/>BFD would be used for this. The node chooses the hello interval; the <lb/>default is once a second. <lb/>6. Advanced Topics <lb/>6.1. Half-rings <lb/>In some cases, a ring H may be incomplete, either because H is <lb/>permanently missing a link (not just because of a failure), or <lb/>because the link required to complete H is in a different IGP area. <lb/>Either way, the ring discovery algorithm will fail. We call such a <lb/>ring a &quot;half-ring&quot;. Half-rings are sufficiently common that finding <lb/>a way to deal with them effectively is a useful problem to solve. <lb/>This topic will not be addressed in this document; that task is left <lb/>for a future document. <lb/>6.2. Hub Node Resilience <lb/>Let&apos;s call the node(s) that connect a ring to the rest of the network <lb/>&quot;hub node(s)&quot; (usually, there are a pair of hub nodes.) Suppose a <lb/>ring has two hub nodes H1 and H2. Suppose further that a non-hub <lb/>ring node X wants to send traffic to some node Z outside the ring. <lb/>This could be done, say, by having targeted LDP (T-LDP) sessions from <lb/>H1 and H2 to X advertising LDP reachability to Z via H1 (H2); there <lb/>would be a two-label stack from X to reach Z. Say that to reach Z, X <lb/>prefers H1; thus, traffic from X to Z will first go to H1 via a ring <lb/>LSP, then to Z via LDP. <lb/>If H1 fails, traffic from X to Z will drop until the T-LDP session <lb/>from H1 to Z fails, the IGP reconverges, and H2&apos;s label to Z is <lb/>chosen. Thereafter, traffic will go from X to H2 via a ring LSP, <lb/>then to Z via LDP. However, this convergence could take a long time. <lb/>Since this is a very common and important situation, it is again a <lb/>
			</body>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 13] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<body>
				useful problem to solve. However, this topic too will not be <lb/>addressed in this document; that task is left for a future document. <lb/>7. Security Considerations <lb/>This document proposes extensions to IS-IS, OSPF, LDP and RSVP-TE, <lb/>all of which have mechanisms to secure them. The extensions proposed <lb/>do not represent per se a compromise to network security when the <lb/>control plane is secured, since any manipulation of the content of <lb/>the messages or even the control plane misinterpretation of the <lb/>semantics are avoided. <lb/>
			</body>

			<div type="acknowledgement">
				8. Acknowledgments <lb/>Many thanks to Pierre Bichon whose exemplar of self-organizing <lb/>networks and whose urging for ever simpler provisioning led to the <lb/>notion of promiscuous nodes. <lb/>
			</div>

			<div type="annex">
				9. IANA Considerations <lb/>There are no requests as yet to IANA for this document. <lb/>
			</div>

			<listBibl>
				10. References <lb/> 10.1. Normative References <lb/>[RFC2119] Bradner, S., &quot;Key words for use in RFCs to Indicate <lb/>Requirement Levels&quot;, BCP 14, RFC 2119, <lb/>DOI 10.17487/RFC2119, March 1997, <lb/>&lt;https://www.rfc-editor.org/info/rfc2119&gt;. <lb/>10.2. Informative References <lb/>[I-D.ietf-mpls-rfc4379bis] <lb/>Kompella, K., Swallow, G., Pignataro, C., Kumar, N., <lb/>Aldrin, S., and M. Chen, &quot;Detecting Multi-Protocol Label <lb/>Switched (MPLS) Data Plane Failures&quot;, draft-ietf-mpls-<lb/>rfc4379bis-09 (work in progress), October 2016. <lb/>[RFC3209] Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan, V., <lb/>and G. Swallow, &quot;RSVP-TE: Extensions to RSVP for LSP <lb/>Tunnels&quot;, RFC 3209, DOI 10.17487/RFC3209, December 2001, <lb/>&lt;https://www.rfc-editor.org/info/rfc3209&gt;. <lb/>[RFC3630] Katz, D., Kompella, K., and D. Yeung, &quot;Traffic Engineering <lb/>(TE) Extensions to OSPF Version 2&quot;, RFC 3630, <lb/>DOI 10.17487/RFC3630, September 2003, <lb/>&lt;https://www.rfc-editor.org/info/rfc3630&gt;. <lb/>
			</listBibl>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 14] <lb/></page>

			<note place="headnote">Internet-Draft <lb/>Resilient MPLS Rings <lb/>October 2019 <lb/></note>

			<listBibl>
				[RFC5036] Andersson, L., Ed., Minei, I., Ed., and B. Thomas, Ed., <lb/>&quot;LDP Specification&quot;, RFC 5036, DOI 10.17487/RFC5036, <lb/>October 2007, &lt;https://www.rfc-editor.org/info/rfc5036&gt;. <lb/>[RFC5305] Li, T. and H. Smit, &quot;IS-IS Extensions for Traffic <lb/>Engineering&quot;, RFC 5305, DOI 10.17487/RFC5305, October <lb/>2008, &lt;https://www.rfc-editor.org/info/rfc5305&gt;. <lb/>[RFC8402] Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L., <lb/>Decraene, B., Litkowski, S., and R. Shakir, &quot;Segment <lb/>Routing Architecture&quot;, RFC 8402, DOI 10.17487/RFC8402, <lb/>July 2018, &lt;https://www.rfc-editor.org/info/rfc8402&gt;. <lb/>
			</listBibl>

			Authors&apos; Addresses <lb/>

			<front>
				Kireeti Kompella <lb/>Juniper Networks, Inc. <lb/>1133 Innovation Way <lb/>Sunnyvale, CA 94089 <lb/>USA <lb/>Email: kireeti.kompella@gmail.com <lb/>Luis M. Contreras <lb/>Telefonica <lb/>Ronda de la Comunicacion <lb/>Sur-3 building, 3rd floor <lb/>Madrid 28050 <lb/>Spain <lb/>Email: luismiguel.contrerasmurillo@telefonica.com <lb/>URI: <lb/>http://people.tid.es/LuisM.Contreras/ <lb/>
			</front>

			<note place="footnote">Kompella &amp; Contreras <lb/>Expires April 25, 2020 <lb/></note>

			<page>[Page 15] </page>

	</text>
</tei>
