<?xml version="1.0" ?>
<tei>
	<teiHeader>
		<fileDesc xml:id="_square"/>
	</teiHeader>
	<text xml:lang="en">
			<note place="headnote">Ocean Dynamics manuscript No. <lb/> (will be inserted by the editor) <lb/></note> 
			
			<front> Optimal boundary conditions at the staircase-shaped <lb/>coastlines. <lb/> Eugene Kazantsev <lb/> the date of receipt and acceptance should be inserted later <lb/> Abstract A 4D-Var data assimilation technique is ap-<lb/>plied to the rectangular-box configuration of the NEMO <lb/>in order to identify the optimal parametrization of boun-<lb/>dary conditions at lateral boundaries. The case of the <lb/>staircase-shaped coastlines is studied by rotating the <lb/>model grid around the center of the box. It is shown <lb/>that, in some cases, the formulation of the boundary <lb/>conditions at the exact boundary leads to appearance <lb/>of exponentially growing modes while optimal bound-<lb/>ary conditions allow to correct the errors induced by <lb/>the staircase-like appriximation of the coastline. <lb/> Keywords: Variational Data Assimilation; Bound-<lb/>ary conditions; NEMO model. <lb/></front>

			<body> 1 Introduction <lb/> Contemporary ocean general circulation models are usu-<lb/>ally discretized by finite differences on a grid with rect-<lb/>angular cells. This discretization simplifies the model <lb/>and accelerates its integration in the middle of the ocean. <lb/>In the same time, it can not provide an accurate approx-<lb/>imation of the model boundary. Ocean coastlines are <lb/>usually approximated by some staircase-like structures <lb/>that neither respect the correct boundary position, nor <lb/>the normal and tangential directions. This problem ari-<lb/>ses as at the bottom of the ocean and at the lateral <lb/>boundary as well. <lb/>This paper is devoted to the analysis of the lateral <lb/>boundary conditions in frames of the rectangular box <lb/>configuration of the Nemo model (see Madec and the <lb/>NEMO team (2012)) in the case when the boundary is <lb/>not aligned with the model grid. The interest of this <lb/> </body>
			
			<front>INRIA, projet MOISE, Laboratoire Jean Kuntzmann, BP 53, <lb/>38041 Grenoble Cedex 9, France. E-mail: kazan@imag.fr <lb/></front> 
			
			<body>study is determined by the difficulties of correct repre-<lb/>sentation of the Gulf Stream separation from the conti-<lb/>nent. In the extended review of the present knowledge <lb/>on this question (Chassignet and Marshall (2013)), it <lb/>is noted that the separation mechanism in numerical <lb/>models remains very sensitive to choices made in the <lb/>numerical model for parameterizations of the dissipa-<lb/>tion and of the boundary layer. Numerous papers are <lb/>devoted to the analysis and comparison of different nu-<lb/>merical schemes that approximate physical mechanisms <lb/>near the step-like coastlines. One can cite the paper <lb/>of Adcroft and Marshall (1998) in which the solution <lb/>of a shallow-water model is analyzed in a square box <lb/>for free-slip and no-slip conditions. It is shown in this <lb/>paper, that inappropriate approximation of the lateral <lb/>friction term may lead to underestimated or overesti-<lb/>mated boundary stress, resulting sometimes in the re-<lb/>placement of free-slip boundary conditions by no-slip <lb/>ones. <lb/>In Dupont et al (2003), the influence of approxima-<lb/>tions of the lateral dissipation is studied together with <lb/>the approximation of the advection term showing that <lb/>some conventional discretizations of this term are also <lb/>inappropriate and may lead to instabilities. <lb/>On the example of inviscid linear shallow-water mo-<lb/>del, it is shown in Griffiths (2013) that staircase-like <lb/>boundary reduces the approximation of the Kelvin wave <lb/>speed down to the first order in h and degrades the ac-<lb/>curacy of numerical simulation of physical phenomena. <lb/>However, even if we follow the recommendations of <lb/>Adcroft and Marshall (1998); Dupont et al (2003) and <lb/>use enstrophy conserving advection scheme together with <lb/>the &quot; vorticity-divergence &quot; form of the viscous stress <lb/>tensor, the influence of the staircase-like boundary is <lb/>still important in a full physics model. In this paper we <lb/>shall analyze western boundary currents produced by <lb/>

			<page> 2 <lb/></page>

			<note place="headnote">Eugene Kazantsev <lb/></note> 
			
			the Nemo model in the presence and in the absence of <lb/>the staircase. The same configuration as in papers cited <lb/>above is used: the model is integrated in a rectangular <lb/>box, but the model grid can be rotated on a desired <lb/>angle around the center of the rectangle. This rotation <lb/>ensures different alignment of the physical boundary <lb/>and the grid while preserving all other dynamical prop-<lb/>erties of the model. <lb/>Several techniques are available to implement the <lb/>complex conditions at immersed boundaries. One of <lb/>them consists in using a finite element method that <lb/>can treat the complex boundary in a more accurate <lb/>way (see, e.g. Danilov et al (2004); Iakovlev (2012)). <lb/>However, up to now, finite element methods are only <lb/>used to discretize ocean models in the most difficult ge-<lb/>ometries and finite differences models dominate due to <lb/>their relative simplicity and robustness. <lb/>Another way to approximate the boundary is to use <lb/>a shaved-cell technique (see, e.g., Adcroft et al (1997); <lb/>Barnier et al (2006) ), which can be viewed as a method <lb/>where the variables are brought to the boundaries by <lb/>means of extrapolation/interpolation. However, this me-<lb/>thod has several disadvantages also: interpolations may <lb/>have to be adapted to ensure stability, accurate dis-<lb/>cretization of the model equations on cut cells is not <lb/>trivial, and special measures may be required to deal <lb/>with very small cut cells. Moreover, as it is shown in <lb/>this paper, application of piecewise shaved cells to ap-<lb/>proximate lateral boundaries may result in unstable ad-<lb/>vection operator. <lb/>Alternative approach, discussed in this paper, sup-<lb/>pose to ask the model&apos;s opinion about &quot; optimal &quot; lateral <lb/>boundary conditions that will be able to compensate <lb/>the error committed by the staircase-like approximation <lb/>of the coastline by the model grid. The word &quot; optimal &quot; <lb/>is used here in the sense of the 4D-Var data assimila-<lb/>tion: what boundary approximation would realize the <lb/>minimum of the specially constructed cost function. <lb/>We follow the procedure proposed in Kazantsev (2013) <lb/>and, instead of controlling the shape of the coast or <lb/>boundary conditions themself, we control the numeri-<lb/>cal scheme that is used to approximate differential op-<lb/>erators in points adjacent to the lateral boundary. As <lb/>it has been noted in Leredde et al (1998), particular <lb/>attention must be paid to the discretization technique <lb/>which must respect several rules because it is the dis-<lb/>cretization of the model&apos;s operators takes into account <lb/>the set of boundary conditions and introduces them into <lb/>the model. Indeed, boundary conditions participate in <lb/>discretized operators, but considering the discretization <lb/>itself, we take into account also the way they influence <lb/>the model. <lb/>The purpose of this paper is to analyze the influ-<lb/>ence of lateral coastline on the model flow in a simple, <lb/>academic configuration of a full-physics model and to <lb/>propose a way of optimization of the approximation of <lb/>the coastline and boundary conditions by variational <lb/>data assimilation. <lb/>As well as in Kazantsev (2013), tangent linear and <lb/>adjoint codes, necessary for variational data assimila-<lb/>tion, have been obtained by the AD Tapenade described <lb/>in Hascoët and Pascual (2004). Particular utility of au-<lb/>tomatic differentiation in the case of boundary condi-<lb/>tions control is related to the fact that the derivative <lb/>of the model with respect to boundary conditions is <lb/>two or three times longer (as well as in terms of the <lb/>development, the number lines of the code and the nec-<lb/>essary CPU time) than the derivative used to control <lb/>the initial point of the model (see Kazantsev (2011) for <lb/>details). <lb/>A rectangular box configuration of the Nemo  1  (the <lb/>Nucleus for European Modelling of the Ocean) is dis-<lb/>cussed here in frames of twin experiments. Pseudo-obser-<lb/>vational data are generated by the model on the grid <lb/>aligned with boundaries. These data are assimilated <lb/>into the same model, but on the grid rotated on some <lb/>angle. <lb/>Two classical wind forcings are considered in the pa-<lb/>per: single and double gyre wind stress at the surface <lb/>of the ocean. The first one provides an almost station-<lb/>ary solution with strong currents near the Western and <lb/>the Northern boundaries allowing us to analyze the in-<lb/>fluence of the staircase shaped approximation of the <lb/>coastline on the flow in the boundary layer. The sec-<lb/>ond one leads to a formation of the jet stream in the <lb/>middle of the rectangle and allows us to simulate the <lb/>separation of the Western boundary currents. <lb/> 2 Rectangular-box configuration on the Nemo <lb/> Rectangular box of 30  •  in longitude and 20  •  in latitude <lb/>is considered with 0.25  •  resolution in both directions. <lb/>In the vertical direction the total depth of 4195m is sep-<lb/>arated into 4 layer of equal thickness. The model grid is <lb/>composed of 120 × 80 × 4 nodes for each variable. This <lb/>configuration is similar to the conventional SEABASS <lb/>configuration of the Nemo. So far, the attention is fo-<lb/>cused on the influence of lateral boundaries, the bottom <lb/>is supposed to be flat. <lb/>Spatially discretized equations of the model are writ-<lb/>ten in the system (1)–(7), in which operators δ [·] and · <lb/> represent conventional second order approximations of <lb/>derivatives and interpolations on the Arakawa C-grid. <lb/>

			<note place="footnote"> 1  http://www.nemo-ocean.eu/ <lb/></note>

			<note place="headnote">Optimal boundary conditions at the staircase-shaped coastlines. <lb/></note>

			<page>3 <lb/></page>

			∂u <lb/> ∂t <lb/> =  v  x y  (ω +  f  ) <lb/> y <lb/> − δx <lb/> 񮽙 <lb/> u  2  x  +  v  2  y <lb/> 2 <lb/> 񮽙 <lb/> − <lb/> 񮽙 <lb/> w  x  δz  [u] <lb/> 񮽙z <lb/>񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Advection <lb/>+  δx  [A  xy <lb/>u  ξ] − DyA  xy <lb/>u  ω <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Lateral diffusion <lb/>+  g <lb/> 񮽙  z <lb/> 0 <lb/> δx <lb/> 񮽙 <lb/> ρ(x, y, ζ) <lb/> z <lb/> 񮽙 <lb/> dζ <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Hydrostatic Press. grad. <lb/>+ <lb/> δz  [A  z <lb/>u  δz  [u]] <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Vertical diffusion <lb/>+ <lb/>+  gδx  [(η +  Tc∂tη)] <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Surface Pres. Grad. <lb/>(1) <lb/> ∂v <lb/>∂t <lb/> = <lb/> 񮽙 <lb/> −u  x y <lb/> 񮽙 <lb/> (ω +  f  ) <lb/> x <lb/> − δy <lb/> 񮽙 <lb/> u  2  x  +  v  2  y <lb/> 2 <lb/> 񮽙 <lb/> − <lb/> 񮽙 <lb/> w  x  δz  [v] <lb/> 񮽙z <lb/>񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Advection <lb/>+  δy  [A  xy <lb/>v  ξ]  +  DxA  xy <lb/>v  ω <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Lateral diffusion <lb/>+  g <lb/> 񮽙  z <lb/> 0 <lb/> δy <lb/> 񮽙 <lb/> ρ(x, y, ζ) <lb/> z <lb/> 񮽙 <lb/> dζ <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Hydrostatic Pressure grad. <lb/>+ <lb/>+ <lb/> δz  [A  z <lb/>v  δz  [v]] <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Vertical diffusion <lb/>+  gδy  [(η +  Tc∂tη)] <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Surface Pres. Grad. <lb/>(2) <lb/> ∂T <lb/>∂t <lb/> =  −δx <lb/> 񮽙 <lb/> (uT <lb/> x  ) <lb/> 񮽙 <lb/> − δy <lb/> 񮽙 <lb/> (vT <lb/> y  ) <lb/> 񮽙 <lb/> − δz <lb/> 񮽙 <lb/> (wT <lb/> z  ) <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Advection <lb/>+  A  xy <lb/>T <lb/> 񮽙 <lb/> δx  [δx [T ]] +  δy  [δy [T ]] <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Lateral diffusion <lb/>+  δz  [A  z <lb/>T  δz  [T ]] <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Vert. diffusion <lb/>(3) <lb/> ∂s <lb/>∂t <lb/> =  −δx  [(us  x  )]  − δy  [(vs  y  )]  − δz  [(ws  z  )] <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Advection <lb/>+  A  xy <lb/>T <lb/> 񮽙 <lb/> δx  [δx [s]] +  δy  [δy [s]] <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Lateral diffusion <lb/>+ <lb/> δz  [A  z <lb/>T  δz  [s]] <lb/> 񮽙 <lb/>񮽙񮽙 <lb/>񮽙 <lb/> Vertical diffusion <lb/>(4) <lb/> ∂η <lb/>∂t <lb/> =  w(x, y, z  = surface) <lb/>(5) <lb/> ξ  =  δx  [u] +  δy  [v]  , ω  =  Dyu − Dxv, <lb/> (6) <lb/> w  = <lb/> 񮽙  z <lb/>bottom <lb/> ξ(x, y, ζ)dζ, ρ  =  ρ(T, s) <lb/> (7) <lb/> Interpolations are calculated as a weighted mean of two <lb/>function values at the adjacent nodes. Weights are de-<lb/>fined to be proportional to the grid steps of correspond-<lb/>ing cells in order to achieve the second order interpola-<lb/>tion of a grid function (see Madec and the NEMO team <lb/>(2012)). However, we write these operators in a simpli-<lb/>fied way, assuming both the argument and the result of <lb/>the interpolation and the derivative are multiplied by <lb/>an appropriate weight: <lb/> w  z  = <lb/> w  i,j,k+1  + w  i,j,k <lb/> 2 <lb/> , δ  y  [u] = <lb/> u  i,j+1,k  − u  i,j,k <lb/> h <lb/> (8) <lb/>Operators D  x  , D  y  (in equations (1),(2),(6)) approx-<lb/>imate derivatives also: they coincide with δ [·] in the <lb/>middle of the ocean, but they may differ from conven-<lb/>tional derivatives near the boundary. <lb/>The set of variables in this system consists of the <lb/>following: u, v and w — zonal, meridional and vertical <lb/>velocity components, T and s — the potential tempera-<lb/>ture and salinity; ξ and ω — horizontal divergence and <lb/>vorticity; η – the sea surface elevation; ρ — the density <lb/>anomaly that is defined as a function of the tempera-<lb/>ture and salinity by the state equation. As one can see, <lb/> u, v, T, s, η are prognostic variables while w, ξ, ω and ρ <lb/> are diagnostic ones. <lb/>Among other parameters in these equations, one can <lb/>see the Coriolis parameter f = 2Ω sin(φ). the gravity <lb/>acceleration g = 9.81 m <lb/>s  2  , lateral diffusion coefficients <lb/> A  xy <lb/>u  = A  xy <lb/>T  = 200 m  2 <lb/> s , coefficients of the vertical diffu-<lb/>sion A  z <lb/>u  = A  z <lb/>v  = 1.2 × 10  −4  m  2 <lb/> s , A  z <lb/>T  = A  z <lb/>s  = 1.2 × <lb/> 10  −5  m  2 <lb/> s . <lb/>The term T  c  ∂  t  η in equations (1) and (2) is intro-<lb/>duced to dump the external gravity waves. These waves <lb/>are fast so their timescale is short with respect to other <lb/>processes described by the primitive equations. Explicit <lb/>resolution of these waves requires an excessively small <lb/>time step, which is not needed to resolve other physi-<lb/>cal processes supported by the equations. Consequently, <lb/>the filter of temporally unresolved external gravity waves, <lb/>proposed in Roullet and Madec (2000), is introduced <lb/>into the model. The cutoff time T  c  is equal to one time <lb/>step of the model. <lb/>The purpose of this paper consists in the variational <lb/>analysis of the influence of the staircase-like boundary <lb/>on the model solution. for this, we formulate several <lb/>model configurations, all of them are based on a rect-<lb/>angular box, aligned with the latitude-longitude co-<lb/>ordinates and placed in the mid-latitude region. The <lb/>model grid may be either aligned with the coordinate <lb/>system (and, hence, with the walls of the box), or in-<lb/>clined at some angle to coordinates. This configuration <lb/>has already been used in numerous papers for simi-<lb/>lar purposes (see, for example Adcroft and Marshall <lb/>(1998); Dupont et al (2003); Griffiths (2013)), but now <lb/>we can benefit more of this set of configurations, assim-<lb/>

			<page> 4 <lb/></page>

			<note place="headnote"> Eugene Kazantsev <lb/></note>

			ilating the information about the solution obtained on <lb/>the aligned grid into the model on inclined grid with <lb/>staircase-like boundaries. <lb/>The box is placed in the mid-latitude region, be-<lb/>tween φ = 24  •  and φ = 44  •  . The model is forced by <lb/>the stationary wind stress with now classical single or <lb/>double gyre pattern. <lb/> τ  φ  = 0, τ  λ  = −0.1 <lb/> N <lb/> m  2  × <lb/> cos(nπ(φ − 24  •  )) <lb/>44  •  − 24  • <lb/> (9) <lb/>where n is either 1 in the single gyre experiments, or <lb/>2 in the double gyre ones. The wind stress influences <lb/>the model solution by the boundary conditions on the <lb/>surface of the ocean, prescribed for the vertical diffusion <lb/>operator δ  z  [A  z  δ  z  [·]]: <lb/> ∂u <lb/>∂z <lb/> 񮽙 <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙 <lb/> surf ace <lb/> = <lb/> τ  x <lb/> hz  1  ρ  0 <lb/> , <lb/> ∂v <lb/>∂z <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙 <lb/>񮽙 <lb/> surf ace <lb/> = <lb/> τ  y <lb/> hz  1  ρ  0 <lb/> , <lb/> where τ  x  and τ  y  are components of the wind stress on <lb/>the model grid that may be inclined at angle ϕ to the <lb/>coordinate system: <lb/> τ  x  = τ  λ  cos(ϕ) − τ  φ  sin(ϕ), τ  y  = τ  λ  sin(ϕ) + τ  φ  cos(ϕ) <lb/>(10) <lb/>The model is discretized on the grid, which repre-<lb/>sents the generalization to three dimensions of the well-<lb/>known &quot; C &quot; grid in Arakawa&apos;s classification Mesinger <lb/>and Arakawa (1976). The arrangement of variables is <lb/>the same in all directions. It consists of cells centered <lb/>on scalar points (T , s, η, ρ) with vector points (u, v, w) <lb/> defined at the center of each face of the cells. The rel-<lb/>ative and planetary vorticity, ω and f , are defined at <lb/>the center of each vertical edge. <lb/>Following Kazantsev (2010), Kazantsev (2012), in-<lb/>stead of controlling physical boundary conditions, we <lb/>use more general framework controlling the way bound-<lb/>ary conditions are introduced in the model operators. <lb/>Thus, expressions for derivatives D  x  , D  y  , are modified <lb/>at the grid-nodes adjacent to the boundary, i.e. near the <lb/>continents. This allows us to control simultaneously the <lb/>boundary conditions, the position of the boundary with <lb/>respect to the grid and the possible interpolation of the <lb/>boundary conditions to the grid. <lb/>Let us suppose the index i = 0 corresponds to the <lb/>left rigid boundary as it is shown in fig.1. That implies <lb/>the index i = 1/2 corresponds to the first v-point in <lb/>the ocean and the index i = 1 corresponds to the first <lb/> ω-point in the ocean. To approximate ∂v <lb/>∂x <lb/> and ∂ω <lb/>∂x <lb/> at <lb/>these points we must take into account the boundary <lb/>conditions prescribed for v and for ω and write either <lb/> ∂v <lb/>∂x <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙 <lb/>񮽙 <lb/> 0 <lb/> = 0, <lb/> ∂ω <lb/>∂x <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙 <lb/>񮽙 <lb/> 1/2 <lb/> = <lb/> ω  1 <lb/> h <lb/> in the case of free-slip condition ω  0  = 0, or <lb/> ∂v <lb/>∂x <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙 <lb/>񮽙 <lb/> 0 <lb/> = <lb/>2v  1/2 <lb/> h <lb/>, <lb/> ∂ω <lb/>∂x <lb/> 񮽙 <lb/>񮽙 <lb/>񮽙 <lb/>񮽙 <lb/> 1/2 <lb/> = <lb/> ω  1  − ω  0 <lb/> h <lb/> in the case of no-slip condition v  0  = 0. <lb/> . . . <lb/> ω  0 <lb/> ω  2 <lb/> ω  3 <lb/> c <lb/> c <lb/>c <lb/> v  3/2 <lb/> v  5/2 <lb/> a <lb/> v  1/2 <lb/> ω  1 <lb/> Fig. 1  Structure of the horizontal grid. <lb/> To control these conditions together with their ap-<lb/>proximations in the model, we approximate them using <lb/>a more general formula <lb/>(D  x  v)  0,j,k  = <lb/> α  Dxv  l <lb/> 0 <lb/> v  1/2,j,k <lb/> h <lb/> (D  x  v)  1,j,k  = <lb/> α  Dxv  l <lb/> 1 <lb/> v  1/2,j,k  + α  Dxv  l <lb/> 2 <lb/> v  3/2,j,k <lb/> h <lb/> (D  x  ω)  1/2,j,k  = <lb/> α  Dxω  l <lb/> 1 <lb/> ω  0,j,k  + α  Dxω  l <lb/> 2 <lb/> ω  1,j,k <lb/> h <lb/> (11) <lb/>where appropriate values are given to coefficients α cor-<lb/>responding to prescribed boundary conditions ( for ex-<lb/>ample, <lb/> α  Dxv  l <lb/> 0 <lb/> = 0, α  Dxv  l <lb/> 1 <lb/> = −1, α  Dxv  l <lb/> 2 <lb/> = 1, <lb/> α  Dxω  l <lb/> 1 <lb/> = 0, α  Dxω  l <lb/> 2 <lb/> = 1 <lb/>(12) <lb/>when free-slip conditions are prescribed). <lb/>Value ofr (D  x  v)  N,j,k  , (D  x  ω)  N −1/2,j,k  , . . . near the <lb/>right boundary are calculated by similar expressions, <lb/>but with different coefficients α  Dxv  r <lb/> 0 <lb/> , α  Dxv  r <lb/> 1 <lb/> , . . .: <lb/> (D  x  v)  N,j,k  = <lb/> α  Dxv  r <lb/> 0 <lb/> v  N −1/2,j,k <lb/> h <lb/> (D  x  v)  N −1,j,k  = <lb/> α  Dxv  r <lb/> 1 <lb/> v  N −1/2,j,k  + α  Dxv  r <lb/> 2 <lb/> v  N −3/2,j,k <lb/> h <lb/> (D  x  ω)  N −1/2,j,k  = <lb/> α  Dxω  r <lb/> 1 <lb/> ω  N,j,k  + α  Dxω  r <lb/> 2 <lb/> ω  N −1,j,k <lb/> h <lb/> (13) <lb/>The same technique is used to approximate operators <lb/> ∂u <lb/>∂y <lb/> ∼ D  y  u and ∂ω <lb/>∂y <lb/> ∼ D  y  ω near the Northern and near <lb/>the Southern boundaries. <lb/>Coefficients α play the role of control variables in <lb/>this paper. Operators D  x  , D  y  are allowed to change <lb/>their properties near the boundaries in order to find <lb/>the best fit with requirements of the model and data. To <lb/>specify optimal values of control variables we perform <lb/>the data assimilation procedure. <lb/>Taking into account that at different points the op-<lb/>timal boundary conditions may differ, we have to con-<lb/>sider the spatially variable coefficients. Thus, α  Dx  and <lb/>

			<note place="headnote"> Optimal boundary conditions at the staircase-shaped coastlines. <lb/></note>

			<page>5 <lb/></page>

			α  Dy  are allowed to vary from one boundary point to <lb/>another. <lb/>In the paper Kazantsev (2013), boundary conditions <lb/>for all derivatives and interpolation operators have been <lb/>controlled. There has been shown that only few of them <lb/>influence the model solution significantly. In this paper, <lb/>we have tried to control all the horizontal operators and <lb/>have selected the boundary conditions for u, v and ω <lb/> only, because they have the largest impact on the so-<lb/>lution in this configuration. More precisely, boundary <lb/>conditions are controlled only in the calculation of the <lb/>relative vorticity and in the vorticity part of the hori-<lb/>zontal dissipation of u and v. <lb/> In order to distinguish the controlled derivatives <lb/>from all others approximation of derivatives δ [·] , we de-<lb/>note them as D  x  , D  y  in equations (1), (2), (6). It should <lb/>be noted that everywhere D  x  · = δ  x  [·], D  y  · = δ  y  [·], ex-<lb/>cept near the boundary. <lb/>Total set of control coefficients α counts about 20 <lb/>000 elements while the dimension of the model state is <lb/>more than 160 000. <lb/> 3 Data assimilation. <lb/> Academic configuration of the model allows us to work <lb/>in frames of twin experiments. The model was spun up <lb/>during 1000 days on the grid aligned with the boundary <lb/>(grid lines are either parallel or perpendicular to the <lb/>coast) starting from the state: <lb/> u = 0, v = 0, η = 0, s = 35.5񮽙, <lb/> T = 25  •  + 24.1  •  × (e  −z/800  − 1) <lb/>The final state of the spin-up is used as the starting <lb/>point to produce the artificial observational data set. <lb/>The model on the aligned grid is started from this state <lb/>and forwarded in time for 100 days. During this run, <lb/>variables u, v and η have been interpolated to the ro-<lb/>tated grid at each time step and the result is saved to be <lb/>used in the assimilation experiments as (u  obs  , v  obs  , η  obs  ). <lb/>The same final state of the spin-up has also been <lb/>interpolated to the rotated grid and used both as the <lb/>background state and as the first guess of the initial <lb/>conditions for the model on the rotated grid. Looking <lb/>for optimal α, we use classical combinations (like (12)) <lb/>both as the first guess and as the background. <lb/>We perform bicubic interpolation to get the vari-<lb/>ables values at nodes of the rotated grid in order to get <lb/>smoother and more precise fields. However, even bicubic <lb/>algorithm occurs to be too inaccurate for the interpo-<lb/>lation of the velocity fields. In fact, ∂u <lb/>∂x <lb/> and ∂v <lb/>∂y <lb/> almost <lb/>compensate each other in the divergence operator (6) <lb/>and even small uncorrelated errors in u and v strongly <lb/>disbalance the divergence and lead to unphysical values <lb/>of the vertical velocity w (7). In order to keep the bal-<lb/>ance of the divergence components, we calculate first <lb/>the relative vorticity and the divergence on the aligned <lb/>grid, interpolate these values to the rotated grid and <lb/>reconstruct the velocity fields on the rotated grid from <lb/>interpolated vorticity and divergence. In the reconstruc-<lb/>tion we have to solve a linear system with N variables <lb/>and N + 1 equations which has an unique solution un-<lb/>der condition <lb/> 񮽙 <lb/> i,j <lb/> 񮽙 <lb/> ∂u <lb/>∂x <lb/> + ∂v <lb/>∂y <lb/> 񮽙 <lb/> i,j <lb/> = 0. But, thanks to <lb/>impermeability condition imposed on the whole bound-<lb/>ary, this condition is always satisfied. Obtained velocity <lb/>fields ensure rather well compensated divergence and <lb/>reduce unphysical effects in the vertical velocity. Only <lb/>a limited noise remains present in the model solution. <lb/>To completely avoid the influence of interpolation <lb/>errors on the model solution, we perform the joint con-<lb/>trol of both initial state and boundary parameters α <lb/> in all experiments below. Taking into account that the <lb/>adjoint model, constructed for controlling the bound-<lb/>ary parameters, contains the whole block necessary to <lb/>control initial conditions, we perform the joint control <lb/>at almost no additional computational cost. <lb/>Thus, in the following experiments we assimilate <lb/>an interpolated solution of the model on the aligned <lb/>grid into the model on the rotated grid. Both data and <lb/>model state are defined at nodes of the same rotated <lb/>grid, consequently, the observational operator is equal <lb/>to identity. The only noise as in the data and in the <lb/>background is due to interpolation errors, i.e. both data <lb/>and background contain an uncorrelated noise of the <lb/>same nature. This fact allows us to use identity covari-<lb/>ance matrices simplifying the cost function. <lb/>The cost function we use in all the assimilation ex-<lb/>periments below has a form <lb/> I = I(u |  t=0  , v |  t=0  , T |  t=0  , s |  t=0  , η |  t=0  , α) = <lb/>= 10  −4 <lb/> 񮽙 <lb/>񮽙 <lb/> (α − α  bgr  )  2  + <lb/> 񮽙 <lb/> xy <lb/> 񮽙 <lb/> (u |  t=0  −u  bgr  )  2  + <lb/>+(v |  t=0  −v  bgr  )  2  + (T |  t=0  −T  bgr  )  2  + <lb/>+(s |  t=0  −s  bgr  )  2  + (η |  t=0  −η  bgr  )  2 <lb/> 񮽙 <lb/> dx dy <lb/> 񮽙 <lb/> + <lb/>+ <lb/> T <lb/> 񮽙 <lb/> 0 <lb/> t <lb/> 񮽙 <lb/> xy <lb/> 񮽙 <lb/> (u − u  obs  )  2  + (v − v  obs  )  2  + <lb/>+(η − η  obs  )  2 <lb/> 񮽙 <lb/> dx dy dt <lb/> (14) <lb/>where (u, v, η) are the velocity components and SSH in <lb/>the solution of the model on the rotated grid at time <lb/> t obtained starting from (u |  t=0  , v |  t=0  , T |  t=0  , s |  t=0 <lb/> , η |  t=0  ) with the discretizations of horizontal operators <lb/>

			<page> 6 <lb/></page>

			<note place="headnote">Eugene Kazantsev <lb/></note> 
			
			D  x  , D  y  in the vicinity of continents defined by the set <lb/>of α. <lb/> Tracers (T and s) are not included in the set of <lb/>data to be assimilated. The background term in the <lb/>cost function is intentionally weighted by a small co-<lb/>efficient. Having &quot; observational &quot; data at any time and <lb/>at each grid-point, the background is important only to <lb/>control the initial condition for tracers. For all dynami-<lb/>cal variables, the observational part of the cost function <lb/>dominates. <lb/>Taking into account the results obtained in Kazant-<lb/>sev (2011), we define the cost function that gives a <lb/>larger weight to the difference &quot; model–observations &quot; at <lb/>the end of the assimilation window. Since we perform <lb/>the data assimilation in order to make a forecast, we <lb/>need a &quot; better &quot; estimate of the model state at the end <lb/>of the assimilation window because this state is used <lb/>as the initial point for the forecasting that starts after <lb/>the assimilation. For this purpose, we force the model <lb/>trajectory to go closer to observations at the end of <lb/>the assimilation window increasing the weight t of the <lb/>distance in the observational part of the cost function. <lb/>To search for a minimum of the cost function, we use <lb/>its gradient with respect to control parameters which <lb/>development is described in Kazantsev (2013). The min-<lb/>imization procedure described in Gilbert and Lemarechal <lb/>(1989) is used in all experiments. This procedure uses <lb/>the gradient of the cost function in the limited memory <lb/>quasi-Newton method. <lb/>Tangent and adjoint models have been automat-<lb/>ically generated by the Tapenade software presented <lb/>in Hascoët and Pascual (2004). This software analyzes <lb/>the source code of a nonlinear model and produces <lb/>the codes of the tangent model and of its adjoint. Ad-<lb/>vantages, shortcoming of the automatic tangent and <lb/>adjoint code generation is described in details also in <lb/>Kazantsev (2013), as well as the adjoint code optimiza-<lb/>tion that is necessary to avoid an excessive memory <lb/>usage. <lb/> 4 Single gyre forcing, 45  •  rotation <lb/> We start experiments from the simplest possible case <lb/>that should clearly distinguish the phenomena related <lb/>to the staircase-like representation of the boundary and <lb/>problems induces by this representation. <lb/>The model is forced by the single-gyre wind stress <lb/>(n = 1 in (9)) and subjected to the impermeability and <lb/>free-slip boundary conditions on the velocity compo-<lb/>nents: <lb/> U · n = 0, <lb/> ∂U · τ <lb/> ∂n <lb/> = 0, <lb/>(15) <lb/>where U = (u, v) is the two-dimensional velocity vec-<lb/>tor, n and τ are normal and tangential directions with <lb/>respect to the boundary and · denotes the scalar prod-<lb/>uct. When the grid is aligned with the boundary, u and <lb/> v represent either normal or tangential velocity compo-<lb/>nents and the boundary conditions become <lb/> 񮽙 <lb/> u = 0, <lb/> ∂v <lb/>∂x <lb/> = 0 <lb/> 񮽙 <lb/> East,West <lb/> , <lb/> 񮽙 <lb/> v = 0, <lb/> ∂u <lb/>∂y <lb/> = 0 <lb/> 񮽙 <lb/> North,South <lb/>(16) <lb/>This implies immediately that the normal velocity com-<lb/>ponent and the relative vorticity must vanish every-<lb/>where on the boundary. <lb/>If we turn the grid on 45  •  we get a staircase-like <lb/>approximation of the 45  •  -slanted (with respect to the <lb/>grid) straight line as shown in fig.2. One can easily un-<lb/>derstand that this approximation automatically modi-<lb/>fies boundary conditions: impermeability becomes im-<lb/>posed at each u and v nodes on the boundary (u  i,i  and <lb/> v  i,i  in fig.2). Indeed, the flux determined by either u or <lb/> v velocity components face a perpendicular segment of <lb/>the stair, obeying the prescribed impermeability con-<lb/>dition. Free-slip condition is taken into account by im-<lb/>posing vanishing relative vorticity at ω  i,i  points without <lb/>accepting non-zero tangential flow. <lb/> b <lb/> b <lb/>b <lb/>b <lb/>b <lb/> ω11 <lb/> ω21 <lb/>ω31 <lb/>ω22 <lb/>ω32 <lb/>ω33 <lb/> u00 <lb/> u10 <lb/>u20 <lb/>u30 <lb/>u11 <lb/>u21 <lb/>u31 <lb/>u22 <lb/>u32 <lb/>v00 <lb/>v10 <lb/>v20 <lb/>v30 <lb/>v11 <lb/>v21 <lb/>v31 <lb/>v22 <lb/>v32 <lb/> 0 <lb/>1 <lb/>2 <lb/>3 <lb/>0 <lb/>1 <lb/>2 <lb/>3 <lb/> Fig. 2  45  •  rotated grid <lb/> Of course, altered boundary conditions modify the <lb/>model solution. To show the difference between solu-<lb/>tions on the aligned grid and on the rotated one, we <lb/>run the model on both grids for 800 days waiting for <lb/>all transition processes are completed and plot two sea <lb/>surface height (SSH) patterns on the 800th day. Solu-<lb/>tions both on the aligned and rotated grids are almost <lb/>stationary with a small waves activity. But the bound-<lb/>ary current near the North coast is more than two times <lb/>

			<note place="headnote"> Optimal boundary conditions at the staircase-shaped coastlines. <lb/></note>

			<page>7 <lb/></page>

			A. <lb/>B. <lb/> Fig. 3  Sea surface height. Reference solution on the aligned grid (A) and the solution on the rotated grid with staircase-like <lb/>boundary (B). <lb/> shorter on the rotated grid (fig.3B) than on the aligned <lb/>one (fig.3A). <lb/>At the first glance, optimal boundary conditions are <lb/>evident in this case and can be obtained without such <lb/>a costly procedure as variational data assimilation. In-<lb/>stead of imposing the impermeability condition on the <lb/>staircase, we should apply a cut-cells approximation <lb/>and impose this condition on the physical boundary <lb/>(slanted line in fig.2) that coincides with the cut-cells <lb/>approximation. In the presented case (45  •  rotated grid), <lb/>impermeability must be represented as u = v every-<lb/>where on the physical boundary ensuring only a tan-<lb/>gential flux. Free-slip condition can be approximated in <lb/>this case by the simple discretization of its formulation <lb/>(15): <lb/> u(x, y)|  bnd  = v(x, y)|  bnd  = v(x + h, y − h), <lb/>v(x, y)|  bnd  = u(x, y)|  bnd  = u(x + h, y − h) <lb/> (17) <lb/>for the part of the boundary schematically represented <lb/>in the fig.2. In other words, for u  i,i  at the boundary we <lb/>put the value of the corresponding v  i,j−1  at the closest <lb/>node in the orthogonal direction. Similarly, the value of <lb/> v  i,i  at the boundary is imposed to be equal to u  i+1,i  . <lb/>Under these conditions, the value of the relative vortic-<lb/>ity on the boundary (ω  i,i  in fig.2), approximated in a <lb/>conventional way, vanishes automatically: <lb/> ω  i,i  = <lb/> v  i,i−1  − v  i−1,i−1 <lb/> h <lb/> − <lb/> u  i,i  − u  i,i−1 <lb/> h <lb/> = <lb/>= <lb/> v  i,i−1  − u  i,i−1 <lb/> h <lb/> − <lb/> v  i,i−1  − u  i,i−1 <lb/> h <lb/> = 0 <lb/>Unfortunately, the most evident idea occurs to be <lb/>a wrong one. Let us consider linearized and simplified <lb/>part of equations (1),(2) that corresponds to the Cori-<lb/>olis parameter: <lb/> ∂u <lb/>∂t <lb/> = v  x y  f <lb/> y  , <lb/> ∂v <lb/>∂t <lb/> = −u  x y  f <lb/> x <lb/> The matrix of this system must have only imaginary <lb/>eigenvalues that ensures only oscillatory modes in the <lb/>solution. This requirement is satisfied when no tangen-<lb/>tial flux is admitted on the boundary, but, accepting <lb/>this flux, we add exponentially growing modes to the so-<lb/>lution. Indeed, consider for example the equation writ-<lb/>ten for the u  2,1  node in fig.2: <lb/> ∂u  2,1 <lb/> ∂t <lb/> = <lb/> v  1,1  + v  2,1  + v  1,0  + v  2,0 <lb/> 4 <lb/> f  2,2  + f  2,1 <lb/> 2 <lb/>The right-hand side of this equation contains v in-<lb/>terpolated to this node. But, the value of v  1,1  on the <lb/>boundary is prescribed to be equal to u  2,1  by the equa-<lb/>tion (17). That means, the matrix of the system con-<lb/>tains diagonal elements <lb/> ∂u  2,1 <lb/> ∂t <lb/> = <lb/> f  2,2  + f  2,1 <lb/> 8 <lb/> u  2,1  + · · · <lb/> and eigenvalues with non-zero real parts (as negatives <lb/>and positives) resulting in existence of exponentially <lb/>growing modes in the solution. <lb/>Consequently, even if we know the exact physical <lb/>boundary of the domain, straightforward approxima-<lb/>tion of the prescribed conditions at this boundary may <lb/>lead to unstable behavior of the model. <lb/>Dealing with real configurations of ocean models, <lb/>the exact boundary is not known. Continental coast-<lb/>lines have a very complex, even fractal, structure and <lb/>it is not evident how to approximate them by the model <lb/>grid. One way to find this approximation consist in <lb/>

			<page> 8 <lb/></page>

			<note place="headnote"> Eugene Kazantsev <lb/></note>

			assimilating external data controlling the approxima-<lb/>tion of differential operators near the boundary. In this <lb/>paper, we assimilate the data, produced by the same <lb/>model on the aligned grid into the model on the ro-<lb/>tated grid. We use the set of three assimilation windows <lb/>(15, 30, and 50 days) in order to reduce computational <lb/>time allowing 20, 50, and 20 iterations in each window <lb/>respectively. As it has been noted above, both initial <lb/>and boundary conditions are controlled in each win-<lb/>dow, but in short windows, mostly the initial state is <lb/>modified, while in long windows essentially the bound-<lb/>ary conditions are corrected. Indeed, is we analyze the <lb/>model solution on the rotated grid, we see that during <lb/>first 15 days the solution is relatively noisy due to er-<lb/>rors committed in the interpolation of the initial point <lb/>on the rotated grid, while later, the interpolation noise <lb/>is already dumped and the shortening of the boundary <lb/>current becomes the principal feature. <lb/>Discretization of 4 differential operators D  x  , D  y  near <lb/>the boundary is controlled in all the experiments below: <lb/>two in the lateral dissipation in the equations (1), (2) <lb/>and two in the calculation of the relative vorticity (6). <lb/>Moreover, according to (11), discretizations of opera-<lb/>tors D  y  u and D  x  v are controlled at two points: at the <lb/>boundary (ω  i,i  points in fig.2) and near the boundary <lb/>(ω  i+1,i  ). In total, 10 control coefficients α are controlled <lb/>near each boundary point: 3 coefficients in the D  x  v ex-<lb/>pression, 3 in the D  y  u, 2 in D  x  ω and 2 in D  y  ω. <lb/> (D  x  v)  i,i,k  = <lb/> α  Dxv <lb/> 0 <lb/> v  i,i−1,k <lb/> h <lb/> (D  x  v)  i+1,i,k  = <lb/> α  Dxv <lb/> 1 <lb/> v  i,i−1,k  + α  Dxv <lb/> 2 <lb/> v  i+1,i−1,k <lb/> h <lb/> (D  y  u)  i,i,k  = <lb/> α  Dyu <lb/> 0 <lb/> u  i,i−1,k <lb/> h <lb/> (18) <lb/>(D  y  u)  i,i−1,k  = <lb/> α  Dyu <lb/> 1 <lb/> u  i,i−2,k  + α  Dyu <lb/> 2 <lb/> u  i,i−1,k <lb/> h <lb/> (D  x  ω)  i,i−1,k  = <lb/> α  Dxω  l <lb/> 1 <lb/> ω  0,j,k  + α  Duω  l <lb/> 2 <lb/> ω  1,j,k <lb/> h <lb/> (D  y  ω)  1/2,j,k  = <lb/> α  Dyω  l <lb/> 1 <lb/> ω  0,j,k  + α  Dyω  l <lb/> 2 <lb/> ω  1,j,k <lb/> h <lb/> Evolution of the cost function with conventional and <lb/>optimal initial-boundary conditions is presented in fig.4. <lb/>One can see that at the end of the longest assimilation <lb/>window (50 days) the cost function value is divided by <lb/>6 and, even 50 days later, the optimal cost function re-<lb/>mains 4 times lower than the original one. This fact in-<lb/>dicates the importance of modification of the boundary <lb/>conditions because the influence of the starting point <lb/>becomes negligible after 100 days integration. <lb/>Optimal coefficients α for the Western and the North-<lb/>ern boundaries are shown in fig.5. The horizontal axis <lb/> Fig. 4  Evolution of the cost function during 100 days: Clas-<lb/>sical boundary conditions (solid red line), Optimal initial and <lb/>boundary conditions (dashed green line). <lb/> points out the position on the boundary indicating the <lb/>angle with the south-western direction in the latitude-<lb/>longitude coordinates. The angle 12  •  corresponds ap-<lb/>proximately to the lower left corner of the rectangle, <lb/>78  •  — to the upper left corner and 198  •  — to the up-<lb/>per right corner. Coefficients are plotted, however, up <lb/>to 160  •  only, because the control is negligible beyond <lb/>the Northern boundary current (about 145  •  , see fig.3). <lb/>No significant modification of α is observed near the <lb/>Eastern and Southern boundaries as well. This can be <lb/>explained by the absence of the boundary flow at these <lb/>places. So far, there is no current, the flow is already <lb/>close to the reference one and the data assimilation does <lb/>not need to modify anything. <lb/>Coefficients α for D  x  operators change sign at the <lb/>upper left corner (78  •  ) because approximations are cal-<lb/>culated by different formula: (11) on the left and (13) <lb/>on the right from 78  •  . <lb/>In this figure one can see significant differences of <lb/>optimal coefficients with respect to the classical deriva-<lb/>tives approximations for operators D  x  v, D  y  u that are <lb/>used in the vorticity calculation. The strongest modifi-<lb/>cation is observed in the approximation of the vorticity <lb/>at adjacent to boundary nodes (ω  i+1,i  in fig.2). At these <lb/>nodes, optimal vorticity is approximated with the coef-<lb/>ficients α  Dxv <lb/> 1 <lb/> , α  Dxv <lb/> 2 <lb/> and α  Dyu <lb/> 1 <lb/> , α  Dyu <lb/> 2 <lb/> which values may <lb/>differ from the conventional +1 or −1 by ±0.4 (dashed <lb/>green and blue lines in fig.5). <lb/>In order to see the influence of the optimal dis-<lb/>cretization of derivatives on the model solution on long-<lb/>time scales, we run the model for 800 days staring from <lb/>optimal initial point found in the data assimilation and <lb/>plot the solution obtained at the end of this run in <lb/>fig.6A. Despite the largest assimilation window was as <lb/>short as 50 days, the sea surface height of the optimal <lb/>solution after 800 days model run is quite close to the <lb/>

			<note place="headnote">Optimal boundary conditions at the staircase-shaped coastlines. <lb/></note>

			<page>9 <lb/></page>

			A. <lb/>B. <lb/> Fig. 5  Optimal coefficients  α  for the Western and the Northern boundaries on the 45  •  rotated grid for derivatives in the  x <lb/> direction (A) and in the  y  direction (B). <lb/> reference one shown in fig.3A. The major difference be-<lb/>tween optimal and reference flows consists in a slightly <lb/>overestimated wave activity. <lb/>Analyzing the magnitude of the control applied to <lb/>different α, we can see that approximations of the dis-<lb/>sipation operators in equations (1), (2) have been mod-<lb/>ified only a little (by less than 0.05) (yellow and cyan <lb/>dashed lines in fig.5). Optimal vorticity value at the <lb/>boundary, calculated with α  Dxv <lb/> 0 <lb/> , α  Dyu <lb/> 0 <lb/> , remains also close <lb/>to 0 all along the boundary except in the lower left cor-<lb/>ner (solid red lines in fig.5). These modifications seem <lb/>to be insignificant and we can suppose that optimal <lb/>vorticity calculation near the boundary is sufficient to <lb/>compensate the effect of the staircase shaped boundary. <lb/>Following this hypothesis, we substitute for α  Dxv  , <lb/> α  Dyu  their &quot; typical &quot; optimal values (±1.4, ±0.6 at the <lb/>adjacent nodes). The vorticity approximation near the <lb/>Western coast becomes: <lb/> ω  i+1,i  = <lb/>0.6v  i+1,i−1  − 1.4v  i,i−1 <lb/> h <lb/> − <lb/> 1.4u  i+1,i  − 0.6u  i+1,i−1 <lb/> h <lb/> = <lb/> v  i+1,i−1  − v  i,i−1 <lb/> h <lb/> − <lb/> u  i+1,i  − u  i+1,i−1 <lb/> h <lb/> − <lb/>− <lb/> 0.8 <lb/> h <lb/>v  i+1,i−1  + v  i,i−1  + u  i+1,i  + u  i+1,i−1 <lb/> 2 <lb/>= δ  x  [v] − δ  y  [u] − <lb/> 0.8 <lb/> h <lb/> (u + v) <lb/> (19) <lb/>Similar modification is also made for the vorticity cal-<lb/>culation at nodes adjacent to the Northern boundary: <lb/> ω  i,j  = <lb/>1.4v  i,j−1  − 0.6v  i−1,j−1 <lb/> h <lb/> − <lb/> 1.4u  i,j  − 0.6u  i,j−1 <lb/> h <lb/> = δ  x  [v] − δ  y  [u] − <lb/> 0.8 <lb/> h <lb/> (u − v) <lb/> (20) <lb/>Moreover, we suppose also that the vorticity may be <lb/>modified near the whole boundary, and namely near the <lb/>Eastern and the Southern coasts despite these modifi-<lb/>cations are not required by the data assimilation. To <lb/>verify this hypothesis, we perform an additional model <lb/>run from the optimal initial point with the only modifi-<lb/>cation defined by equations (19), (20) but applied to the <lb/>whole boundary. The SSH obtained on the 800th day <lb/>in this run can be seen in fig.3B. Indeed, two patterns <lb/>in fig.3 are similar, that confirms the hypothesis: op-<lb/>timization is necessary for the vorticity approximation <lb/>only. <lb/>Of course, the estimation of these &quot; typical &quot; opti-<lb/>mal values is only qualitative. No sensitivity analysis <lb/>of these optimal coefficients is made in this paper and <lb/>no confidence interval is determined because we address <lb/>rather the existence of the optimal discretization than <lb/>precise estimates of coefficients. <lb/>The equation (19) shows that −0.8(u + v)/h has <lb/>been added to the classical approximation of the rela-<lb/>tive vorticity at adjacent nodes. So far, due to free-slip <lb/>condition, the tangential velocity u + v does not vanish, <lb/>we have got minus first order of the vorticity approxi-<lb/>mation. Similar situation is observed near the northern <lb/>boundary: corresponding value (−0.8(u−v)/h in this <lb/>case) is also added to the conventional approximation. <lb/>In order to interpret the addition of −0.8(u±v)/h to <lb/>the approximation of the relative vorticity, we can refer <lb/>to Blayo (1994); Verron and Blayo (1996) who show <lb/>the free-slip condition must be formulated as ω  bnd  = <lb/> U · τ <lb/> R instead of ω  bnd  = 0 in the case of a curvilinear <lb/>boundary. Taking into account that tangential velocity <lb/>components are equal to (U · τ ) = (u + v)/ <lb/> √ <lb/> 2 near the <lb/>Western coast and to (u−v)/ <lb/> √ <lb/> 2 near the Northern one, <lb/>the additional term in (19), (20) is always proportional <lb/>to the tangential velocity component <lb/> − <lb/> 0.8(u ± v) <lb/>h <lb/> = − <lb/> 0.8 <lb/> √ <lb/> 2(U · τ ) <lb/> h <lb/> = <lb/> U · τ <lb/> R <lb/> (21) <lb/>

			<page> 10 <lb/></page>

			<note place="headnote">Eugene Kazantsev <lb/></note>
			
			A. <lb/>B. <lb/> Fig. 6  Sea surface height on the 800th day. Solutions on the rotated grid: optimal (A) and modified (B) boundary conditions. <lb/> where R = − h <lb/> 0.8 <lb/> √ <lb/> 2 <lb/>. <lb/>Consequently, the optimal boundary determined by <lb/>data assimilation in this case is neither a straight line, <lb/>nor a staircase, but a curvilinear boundary with con-<lb/>stant curvature radius R = − h <lb/> 0.8 <lb/> √ <lb/> 2 <lb/>. The additional <lb/>term in (19), (20) can be interpreted as the influence of <lb/>a curvilinear boundary with curvature radius R on the <lb/>vorticity: at the nearest to boundary points, the vor-<lb/>ticity is calculated by the usual formula δ  x  [v] − δ  y  [u] <lb/>because this node is in ocean, but an additional term <lb/>(U · τ )/R is added due to curvilinearity requirement. <lb/>So far, the optimal curvature depends on the grid <lb/>step h and the resolution may influence the optimal ra-<lb/>dius R, we perform two additional experiments: with <lb/>the double resolution (h = 1  •  /8) and the half resolu-<lb/>tion (h = 1  •  /2) keeping all other parameters (including <lb/>lateral dissipation) unchanged. As well as abobe, the <lb/>final state of the 1000 days spin-up is interpolated to <lb/>the rotated grid and the model runs for 800 days from <lb/>this state either with the classical or with the optimal <lb/>(defined by (19), (20)) discretization of derivatives in <lb/>the vorticity operator. Final states of the double resolu-<lb/>tion model are shown in fig.7 and of the half-resolution <lb/>model in fig.8. <lb/>One can see in these figures that finer resolution im-<lb/>prove the solution with the classical approximation of <lb/>the boundary conditions: the northern boundary cur-<lb/>rent is longer in fig.7A than in fig.3B while this cur-<lb/>rent is almost absent fig.8A. On the other hand, the <lb/>model with optimal discretization of the vorticity pro-<lb/>vides quite similar results independently on the reslu-<lb/>tion: fig.8B, fig.6B, fig.7B. <lb/> 5 Single gyre forcing, 30  •  rotation <lb/> More complicated case of the rotation on 30  •  is dis-<lb/>cussed in this section. We consider the model with all <lb/>the same parameters as described above on the h = <lb/>1 <lb/>4 <lb/> • <lb/> resolution grid but the staircase is not uniform. <lb/>The same data assimilation experiments have been per-<lb/>formed. <lb/>The sea surface height on the 800th day integration <lb/>of the model on the 30  •  rotated grid is shown in fig.9A. <lb/>One can see, a non-uniform staircase-like boundary de-<lb/>grades more the solution than the uniform staircase: <lb/>the Northern boundary current is shorter and its am-<lb/>plitude is smaller than in fig.3B. But, as well as in the <lb/>case of 45  •  rotated grid, optimal condition allows to get <lb/>a similar SSH pattern as the reference one fig.3A. <lb/>Optimal coefficients α at the Western and the North-<lb/>ern boundaries are plotted in fig.11. The horizontal axis <lb/>indicates the angle with the direction from the center <lb/>to the lower-left corner of the rectangle. The upper left <lb/>corner corresponds approximately to the angle 64  •  and <lb/>the upper right corner – to 180  •  . However, we plot the <lb/>coefficients α up to 140  •  because beyond this angle <lb/>there is no flux in the reference solution and, conse-<lb/>quently, coefficients α are not modified by data assim-<lb/>ilation. This is also true for the Eastern and Southern <lb/>boundaries where all α are very close to their default <lb/>values (12). <lb/>Comparing fig.11 and fig.5, we can see significant <lb/>differences. First of all, due to non-uniformity of the <lb/>staircase, there are significant variations of α from point <lb/>to point. That means the curvature radius is no longer <lb/>constant, but specific for each particular stair varying <lb/>from R = −h to R = +5h. Second, the amplitude of <lb/>variations exceeds sometimes ±0.6 while the coefficients <lb/>

			<note place="headnote">Optimal boundary conditions at the staircase-shaped coastlines. <lb/></note>

			<page>11 <lb/></page>

			A. <lb/>B. <lb/> Fig. 7  Sea surface height on the 800th day for the (h = 1 <lb/>8 <lb/> •  ) resolution. Solutions on the rotated grid: classical (A) and modified <lb/>by (19) (B) boundary conditions. <lb/>A. <lb/>B. <lb/> Fig. 8  Sea surface height on the 800th day for the (h = 1 <lb/>2 <lb/> •  ) resolution. Solutions on the rotated grid: classical (A) and modified <lb/>by (19) (B) boundary conditions. <lb/> in the previous experiment were modified by ±0.4 at <lb/>maximum. And third, contrary to fig.5, coefficients α  0 <lb/> (solid red lines) used in calculation of the vorticity at <lb/>the boundary are also strongly modified. Despite the <lb/>default is α  0  = 0, their values may exceed ±1. <lb/> Schematic representation of optimal boundaries on <lb/>30  •  and 45  •  rotated grids is shown in fig.10. Optimal <lb/>coastline is shown as a sequence of the segments with <lb/>the constant curvature R = h <lb/> √ <lb/> 2 in the case of 45  •  ro-<lb/>tated grid and with variable curvature in the case of 30  • <lb/> rotated grid. Particular curvature radius near each vor-<lb/>ticity node corresponds to particular set of coefficients <lb/> α that is considered to be optimal to approximate the <lb/>vorticity at this node. <lb/> 6 Double gyre forcing, 30  •  rotation <lb/> And finally, we discuss the most complex case in this <lb/>paper: the model on the 30  •  rotated grid is subjected <lb/>to the double gyre forcing (n = 2 in (9)). Principal <lb/>difference with the previous cases consists in a more <lb/>complex model behavior that seems to be chaotic. The <lb/>jet-stream in the middle of the rectangle exhibits irreg-<lb/>ular variations and displacements requiring to consider <lb/>statistically stables long-term average fields instead of <lb/>instantaneous patterns. <lb/>The principal influence of the staircase-like approx-<lb/>imation of the boundary consists in the modification of <lb/>the direction of the jet that becomes directed slightly to <lb/>the North and the displacement of the starting point of <lb/>the jet for 60-70 km to the North also. These modifica-<lb/>

			<page> 12 <lb/></page>

			<note place="headnote">Eugene Kazantsev <lb/></note>
			
			A. <lb/>B. <lb/> Fig. 9  Sea surface height on the 800th day. Solutions on the 30  •  rotated grid: classical (A) and optimal (B) boundary <lb/>conditions. <lb/>A. <lb/>B. <lb/> Fig. 11  Optimal coefficients  α  for the Western and the Northern boundaries of the 30  •  rotated grid for derivatives in  x <lb/> direction (A) and in the  y  direction (B). <lb/> Fig. 10  Schematic representation of optimal boundaries on <lb/>30  •  and 45  •  rotated grids: slanted grey lines represent the <lb/>presumed exact coastline, black segments — optimal coast-<lb/>line. <lb/> tions are related to the Gulf Stream separation problem <lb/>that attract much attention during last 25 years (see, <lb/>for example Verron and Blayo (1996); Chassignet and <lb/>Marshall (2013)). Supposing that boundary conditions <lb/>control may also be useful in solving this problem, we <lb/>perform the same assimilation experiments as described <lb/>above: a sequence of three assimilation windows 15, 30, <lb/>50 days with 20, 50, 30 iteration in each window respec-<lb/>tively controlling both initial and boundary conditions. <lb/>Three 30 years model runs were performed in or-<lb/>der to get statistically stable averages. The first one <lb/>was the reference model run on the grid aligned with <lb/>the boundary. The second and the third runs were per-<lb/>formed on the grid rotated on the 30  •  with respect to <lb/>the boundary. Classical free-slip boundary conditions <lb/>on the staircase shaped boundary have been used in <lb/>the second run and optimal α have been used in the <lb/>third run. <lb/>

			<note place="headnote"> Optimal boundary conditions at the staircase-shaped coastlines. <lb/></note>

			<page>13 <lb/></page>

			A. <lb/>B. <lb/>C. <lb/> Fig. 12  30 years average of the sea surface height. Reference model on the aligned grid (A), Model on the 30  •  rotated grid: <lb/>classical (B) and optimal (C) boundary conditions. <lb/> So far, the major difference in these runs is observed <lb/>near the western boundary, the zoom of this region only <lb/>is shown in the fig.12. Theoretical middle latitude in <lb/>this rectangle is equal to the 34  •  latitude (the bound-<lb/>aries are placed at 24  •  and 44  •  ). The zero SSH line <lb/>passes at 34.2  •  in the reference and in the optimal ex-<lb/>periments but this line starts at 34.8  •  and goes up to <lb/>the 35.3  •  latitude in the experiment on the rotated grid. <lb/>That means the point of the separation of the western <lb/>boundary currents is moved 0.6  •  = 66 km to the North <lb/>and the flux direction is no longer aligned with the lat-<lb/>itude. <lb/>The main difference between fig.12A and fig.12C <lb/>consists in the overestimated negative SSH anomaly <lb/>and in the 1  •  shorter jet. This difference is probably <lb/>due to insufficient width of the assimilation window. <lb/>Indeed, we assimilate information about the reference <lb/>model during 50 days only while comparing the model <lb/>runs on 30 years, i.e. more than 200 times longer inter-<lb/>val. However, we make no effort to get more resembling <lb/>solutions because the purpose of this paper is just to <lb/>show the potential improvement due to the boundary <lb/>conditions optimization. Moreover, a fine justification <lb/>is not interesting in such an academic configuration as <lb/>a rectangular box. <lb/> 7 Conclusions and perspectives <lb/> We have analyzed the influence of the staircase-like ap-<lb/>proximation of the boundary on the model solution <lb/>and have proposed a way to compensate this influence <lb/>by optimization of the discretization of the derivatives <lb/>operators in calculation of the relative vorticity near <lb/>the boundary. Several experiments carried out with the <lb/>rectangular box configuration of Nemo model show the <lb/>possibility of such a compensation for a model forced <lb/>both by a single-gyre and a double gyre surface wind. <lb/>Optimal boundary conditions found in the data as-<lb/>similation procedure allow us to get the model solu-<lb/>tion that is rather close to the solution of the reference <lb/>model. These conditions seem to be independent on the <lb/>model&apos;s resolution, but they depend on all other param-<lb/>eters of the model and have to be determined for each <lb/>particular configuration. Optimal model boundary is a <lb/>curvilinear boundary with the curvature depending on <lb/>the model configuration and on the approximation of <lb/>the boundary by the grid. <lb/>Even in the simplest cases, optimal boundary does <lb/>not coincide with the presumably known exact one. <lb/>Considering a real ocean, the coastline has an extremely <lb/>complex, even fractal, structure and the optimization <lb/>of its approximation by the data assimilation seems <lb/>to be a promising way in formulation of an adequate <lb/>model coastline and boundary conditions. Moreover, in <lb/>realistic cases one has to consider a three-dimensional <lb/>staircase-like approximation of the coast, especially with <lb/>geopotential vertical coordinate: decreasing ocean depth <lb/>leads to the formulation of the boundary conditions si-<lb/>multaneously both at the lateral coastline and at the <lb/>bottom topography. Flow interactions with the staircase-<lb/>like continental slope should also be analyzed in this <lb/>case. <lb/>However, as well as in Kazantsev (2013), we can not <lb/>pretend to solve a parameter identification problem. <lb/>In frames of twin experiments, we assimilate perfect <lb/>unperturbed data with no effort to analyze the sensi-<lb/>tivity of obtained &quot; optimal &quot; discretizations to possible <lb/>noise in the observational data. Moreover, only a lim-<lb/>ited number of iterations is allowed in the minimization <lb/>process leading to the fact that the convergence is far <lb/>from even a local minimum of the cost function and, <lb/>consequently, obtained values are far from the really <lb/>optimal values for a given configuration. The problem <lb/>of parameter identification is, of course, a very inter-<lb/>esting, but difficult challenge that must address many <lb/>mathematical and numerical issues like uniqueness and <lb/>stability of the identified parameter, convexity of the <lb/>cost function, etc. All these issues require a particular <lb/>

			<page> 14 <lb/></page>

			<note place="headnote">Eugene Kazantsev <lb/></note>

			and detailed study. The purpose of this paper is to show <lb/>the result we can potentially get optimizing boundary <lb/>conditions for realistic models and which operators and <lb/>which variables of the model should be optimized in <lb/>order to compensate model errors due to inappropriate <lb/>approximation of the boundary. <lb/>The academic configuration used in this paper al-<lb/>lowed us to analyze the interaction of the model flow <lb/>with the lateral boundary and to show that even if we <lb/>know the position of the exact boundary, we can fail <lb/>formulating the boundary conditions. The boundary of <lb/>the rectangle on the 45  •  rotated grid passes exactly by <lb/>the grid nodes, but the model becomes unstable under <lb/>boundary conditions formulated at these nodes. <lb/>We could think that these instabilities were due to <lb/>the interpolations (v  x y  and u  y x  in (1), (2)) in the ad-<lb/>vection operator and they could be avoided by using <lb/>some another interpolation scheme. However, it is not <lb/>evident how to change these interpolations preserving <lb/>conservation of the mass and the enstrophy. Moreover, <lb/>we have performed several unsuccessful attempts trying <lb/>to control the interpolation scheme near the boundary. <lb/>Indeed, operators u  y  , v  x  are very similar to D  y  u, D  x  v, <lb/> with just different numerical values of coefficients. We <lb/>can also control the discretization of these interpola-<lb/>tions near the boundary by data assimilation. How-<lb/>ever, similar experiments do not allow to find an op-<lb/>timal scheme: neither the cost function decreases, nor <lb/>the boundary current elongates. <lb/>This fact leads us to the conclusion: data assimila-<lb/>tion and control of the boundary conditions shows us <lb/>the easiest, the most economic way for the model <lb/> to bring the solution closer to the observational data. <lb/>This way may be different from the way we find the <lb/>easiest for us. Instead of inclined (with respect to the <lb/>grid) straight line that was supposed to be the exact <lb/>boundary in the experiment with the 45  •  rotated grid, <lb/>we have got a highly curvilinear boundary that realise <lb/>the most economic modification of the boundary con-<lb/>ditions from the point of view of the model. <lb/>Obtained &quot; optimal &quot; boundary conditions may vio-<lb/>late the physical background of the model conception <lb/>in cases when there is no other way to bring the model <lb/>solution closer to observations. Thus, physically doubt-<lb/>ful condition of non-zero velocity at the bottom was <lb/>found by the model to be the easiest way to intensify <lb/>the surface jet-streams (Gulf Stream and Kuroshio) in <lb/>the low-resolution global ocean configuration of Nemo <lb/>known as Orca-2 (see Kazantsev (2013)). Indeed, 2  • <lb/> resolution and high lateral viscosity leave no possibility <lb/>to intensify the jets without external inflow of energy. <lb/>Data assimilation just indicates where this inflow must <lb/>be placed in order to limit it&apos;s magnitude. <lb/>On the other hand, issues concerning stability and <lb/>conservative properties of the optimal scheme are sat-<lb/>isfied almost automatically. The assimilation window <lb/>must be chosen sufficiently long in order to let poten-<lb/>tial instabilities be developed within the window. In <lb/>this case, an unstable solution will not be accepted <lb/>by data assimilation as an optimal one. Conservative <lb/>properties, indeed, may be violated in certain cases, es-<lb/>pecially when some mass or energy flux is present in <lb/>the assimilated data. In this paper, twin data are as-<lb/>similated ensuring no noticeable trend of mass, energy <lb/>and enstrophy even on 30 years time interval. But, as-<lb/>similating real data that contain a flux of an integral <lb/>quantity, we should be ready to add a constraint in the <lb/>cost function to ensure the conservation of an appro-<lb/>priate integral and avoid long-term trends. Thus, we <lb/>had to add the total mass conservation requirement in <lb/>Kazantsev (2012) to compensate the mass flux in the <lb/>satellite observations of SSH in the Black sea. <lb/>Consequently, if we want to &quot; improve &quot; the model <lb/>solution, the data assimilation can show us how to do <lb/>this, but this information should be analyzed from the <lb/>point of view of agreement with the physical concept of <lb/>the model. <lb/>The use of the automatic differentiation tool proves <lb/>to be extremely useful in this study helping us to avoid <lb/>the huge coding and debugging work. This fact is ap-<lb/>preciated in the situation when we intend to control <lb/>the distributed parameters rather than the initial con-<lb/>dition. <lb/>
			
		</body>	
			
		<back>
				
			<div type="acknowledgement">Acknowledgements: Author would like to express <lb/>his gratitude to Julien Le Sommer for helpful discus-<lb/>sions on the physical background of the model. This <lb/>work was supported by the French National Programme <lb/>LEFE/INSU-GMMC. All the contour pictures have been <lb/>prepared by the Grid Analysis and Display System (GrADS) <lb/>developed in the Centre for Ocean-Land-Atmosphere <lb/>Interactions, Department of Meteorology, University of <lb/>Maryland. <lb/></div>

			<listBibl> References <lb/> Adcroft A, Marshall D (1998) How slippery are piecewise-<lb/>constant coastlines in numerical ocean models? Tellus <lb/>50A:95–108 <lb/>Adcroft A, Hill C, Marshall J (1997) Representation of topog-<lb/>raphy by shaved cells in a height coordinate ocean model. <lb/>Mon.Wea.Rev 125:2293–2315 <lb/>Barnier B, Madec G, Penduff T, Molines JM, Treguier AM, <lb/>Sommer JL, Beckmann A, Biastoch A, Boning C, Dengg <lb/>J, Derval C, Durand E, Gulev S, Remy E, Talandier C, <lb/>Theetten S, Maltrud M, McClean J, Cuevas BD (2006) <lb/>Impact of partial steps and momentum advection schemes <lb/>in a global ocean circulation model at eddy-permitting <lb/>resolution. Ocean Dyn. 56(5-6):543567 <lb/> 
			
			<note place="headnote">Optimal boundary conditions at the staircase-shaped coastlines. <lb/></note>
			
			<page>15 <lb/></page>
			
			Blayo E (1994) A regional quasigeostrophic circulation model <lb/>of the western north atlantic: a model-data comparison. <lb/>J. of Marine Systems 5(6):425–443 <lb/>Chassignet EP, Marshall DP (2013) Gulf Stream Separa-<lb/>tion in Numerical Ocean Models, American Geophysical <lb/>Union, pp 39–61. DOI 10.1029/177GM05 <lb/>Danilov S, Kivman G, Schrter J (2004) A finite-element ocean <lb/>model: principles and evaluation. Oc. Model. 6(2):125 – <lb/>150 <lb/>Dupont F, Straub D, Lin C (2003) Influence of a step-like <lb/>coastline on the basin scale vorticity budget of mid-<lb/>latitude gyre models. Tellus A 55(3):255–272 <lb/>Gilbert J, Lemarechal C (1989) Some numerical experiments <lb/>with variable storage quasi-newton algorithms. Mathe-<lb/>matical programming 45:407–435 <lb/>Griffiths SD (2013) Kelvin wave propagation along straight <lb/>boundaries in c-grid finite-difference models. J. Comp. <lb/>Phys. 255:639 – 659 <lb/>Hascoët L, Pascual V (2004) Tapenade 2.1 user&apos;s guide. Tech-<lb/>nical Report 0300, INRIA, http://www.inria.fr/rrrt/rt-<lb/>0300.html <lb/>Iakovlev N (2012) On the simulation of temperature and <lb/>salinity fields in the arctic ocean. Izvestiya, Atm. and Oc. <lb/>Phys. 48(1):86–101 <lb/>Kazantsev E (2010) Identification of an optimal boundary <lb/>approximation by variational data assimilation. J. Comp. <lb/>Phys. 229(2):256–275 <lb/>Kazantsev E (2011) Optimal boundary discretisation by vari-<lb/>ational data assimilation. Int. J. for Num. Meth. in Fluids <lb/>65(10):1231–1259, <lb/>Kazantsev E (2012) Boundary conditions control for a <lb/>shallow-water model. Int. J. for Num. Meth. in Fluids, <lb/>68(5):625–641 <lb/>Kazantsev E (2013) Optimal boundary conditions for Orca-2 <lb/>model. Oc. Dyn. 63(8):943–959 <lb/>Leredde Y, Lellouche JM, Devenon JL, Dekeyser I (1998) <lb/>On initial, boundary conditions and viscosity coefficient <lb/>control for Burgers&apos; equation. Int. J. for Num. Meth. in <lb/>Fluids 28(1):113–128 <lb/>Madec G, the NEMO team (2012) Nemo ocean engine. Tech. <lb/>Rep. 27, Note du Pôle de modélisation de l&apos;Institut Pierre <lb/>Simon Laplace <lb/>Mesinger F, Arakawa A (1976) Numerical methods used in <lb/>Atmospheric models. GARP Publication Series No 17 <lb/>Roullet G, Madec G (2000) salt conservation, free surface, <lb/>and varying levels: a new formulation for ocean general <lb/>circulation models. J.Geoph.Res 105:23,927–23,942 <lb/>Verron J, Blayo E (1996) The no-slip condition and separation <lb/>of western boundary currents. J. Phys. Oc. 26(9):1938– <lb/>1951</listBibl>

		</back>
	</text>
</tei>
