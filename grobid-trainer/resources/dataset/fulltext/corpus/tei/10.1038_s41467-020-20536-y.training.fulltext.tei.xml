<?xml version="1.0"?>
<tei xml:space="preserve">
	<teiHeader>
		<fileDesc xml:id="0"/>
	</teiHeader>
	<text xml:lang="en">
			<p>H<lb/> igh-quality reference genomes are an indispensable<lb/> resource for basic and applied research in biology, geno-<lb/>mics, agriculture, medicine, and many other fields <ref type="biblio">1-3</ref> .<lb/> Technological innovations in DNA sequencing, long-range gen-<lb/>otyping, and assembly algorithms have led to rapidly declining<lb/> costs of sequencing and computation for genome assembly pro-<lb/>jects <ref type="biblio">4</ref> . A major challenge for de novo assembly of genomes of<lb/> outbred, non-model, diploid and polyploid organisms is accurate<lb/> haplotype resolution. Most genome assemblers collapse multiple<lb/> haplotypes into a single consensus sequence to generate a pseudo-<lb/>haploid reference. Unfortunately, this process results in mosaic<lb/> haplotypes with erroneously associated variants not present in<lb/> either haplotype, with concomitant negative impacts on biological<lb/> inference <ref type="biblio">5-7</ref> .<lb/></p>

			<p>Four approaches to haplotype resolution in long-read diploid<lb/> genome assembly have been described. Trio binning uses short-<lb/>read sequence data of the parents to identify parent-specific k-<lb/>mers, which are then used to bin long-read sequence data of the<lb/> offspring into maternal and paternal bins <ref type="biblio">8-10</ref> . These parent-<lb/>specific read bins can be separately assembled into two haploid<lb/> genomes, as with TrioCanu <ref type="biblio">9</ref> or binned within the assembly<lb/> graph, as with hifiasm <ref type="biblio">10</ref> . Trio binning provides accurate phased<lb/> assemblies but requires that samples of the parents are available,<lb/> which is often not possible. A second approach phases reads by<lb/> mapping to an existing reference genome to infer haplotypes,<lb/> followed by long-read partitioning and assembly <ref type="biblio">11-14</ref> . Read-based<lb/> phasing methods require that a reference assembly is available<lb/> and depends on single-nucleotide variant (SNV) calling, which<lb/> has associated errors. A third approach is to use Strand-seq <ref type="biblio">15</ref> to<lb/> sequence DNA template strands only, but not the nascent strands<lb/> that have been selectively labeled and targeted for removal. The<lb/> advantage of this method is that structural contiguity of indivi-<lb/>dual homologs is maintained, but it requires living cells and at<lb/> least one cell division with BrdU labeling, and thus is not easily<lb/> scalable for many species or individuals of a species. The fourth<lb/> approach is to separate haplotypes during the genome assembly<lb/> process as implemented by FALCON-Unzip for long reads <ref type="biblio">16</ref> ,<lb/> DipAsm for Hi-C and long reads <ref type="biblio">17</ref> , and Supernova for short<lb/> reads <ref type="biblio">18</ref> . The length of the phase blocks produced by these<lb/> methods are, however, limited by sequence read length and depth<lb/> of coverage in the diploid genome.<lb/></p>

			<p>To address these issues, we developed FALCON-Phase, an<lb/> assembly processing pipeline that uses the natural intra-<lb/>chromosomal interactions identified by Hi-C to phase paternal<lb/> and maternal contigs and their associated haplotigs from a long-<lb/>read assembly of a diploid organism. A haplotig is an assembled<lb/> sequence from a single haplotype and there are typically several<lb/> haplotigs interspersed along their primary contig (Fig. <ref type="figure">1</ref>). A<lb/> fundamental limitation of partially phased long-read assemblies is<lb/> that the phase between neighboring haplotigs is unknown.<lb/> FALCON-Phase solves this problem in an efficient fashion, not<lb/> by calling or phasing SNP variants relative to an existing refer-<lb/>ence genome, but by using the ultra-long-range (&gt;1 Mb) infor-<lb/>mation from the mapping of unique, haplotype-specific, Hi-C<lb/> read pairs <ref type="biblio">19-21</ref> and a stochastic algorithm to establish correct<lb/> linkage between haplotigs along a contigs.<lb/></p>

			<p>FALCON-Phase uses a partially phased contig assembly and<lb/> Hi-C data, which can be obtained for many samples, including<lb/> field-collected organisms for which trio samples may not be<lb/> available. We apply our method to PacBio long-read de novo<lb/> genome assemblies of three species with different levels of het-<lb/>erozygosity. Performance of our method is best with high het-<lb/>erozygosity samples: zebra finch (Taeniopygia guttata), and an<lb/> intersubspecies cross of Bos taurus <ref type="biblio">8,9</ref> (a male fetus, but referred to<lb/> as cow for simplicity), achieving 97% accuracy, whereas the<lb/> lower-heterozygosity human samples have phasing accuracy of<lb/> 80-91%. By applying our phasing method to contigs and scaffolds<lb/> in two separate iterations it is possible to extend haplotype<lb/> phasing to chromosomes scale.<lb/></p>

			<head>Results<lb/></head>

			<head>FALCON-Phase: a Hi-C haplotype-phasing tool for long-read<lb/> assemblies. </head>

			<p>FALCON-Phase inputs a partially phased long-read<lb/> assembly, such as one from FALCON-Unzip, and extends the<lb/> phasing on the contigs using Hi-C reads from the same sample.<lb/></p>

			<p>The method leverages the higher density of cis-interactions for<lb/> Hi-C read pairs to regroup phase blocks (haplotigs) into haplo-<lb/>types along a contig <ref type="biblio">11</ref> . First, the haplotype phase blocks are<lb/> defined by aligning the alternate haplotigs to their associated<lb/> primary contigs (Fig. <ref type="figure">1b</ref>). Breaks (minces) in the contigs are<lb/> introduced to separate phased from unphased (collapsed haplo-<lb/>type) regions (Fig. <ref type="figure">1c</ref>). Hi-C read pair mapping density is then<lb/> used to classify haplotype blocks that are in the same phase (same<lb/> parental homolog) along each contig (Fig. <ref type="figure">1d, e</ref>). The assembly<lb/> sequences are then expanded by integrating the collapsed<lb/> sequences into both haplotypes to obtain two contig sets that<lb/> contain either maternal or paternal phase blocks interspersed<lb/> with the collapsed regions (Fig. <ref type="figure">1f</ref>). Although FALCON-Phase<lb/> groups maternal and paternal sequences from the same chro-<lb/>mosomes, it is agnostic as to which parent the assembled chro-<lb/>mosomes came from. Details of the method, including equations<lb/> and algorithms, are described in the methods.<lb/></p>

			<head>Over 90% of paternal and maternal contigs correctly phased.<lb/> </head>

			<p>We tested FALCON-Phase on three vertebrate species for which<lb/> we had trio-binned assemblies from the same data: two human<lb/> samples (HG00733 and mHomSap3), zebra finch, and cow (see<lb/> &quot;Data availability&quot;). In order to most accurately assess the per-<lb/>formance of our method, we removed errors in the starting de<lb/> novo assembly first by breaking chimeric contigs containing<lb/> sequences from different chromosomes for all samples using<lb/> visualization of Hi-C read density with Juicebox <ref type="biblio">22</ref> . Second, for the<lb/> highest heterozygosity sample, zebra finch, it was also necessary<lb/> to run purge haplotigs <ref type="biblio">23</ref> to remove haplotype duplications in the<lb/> primary contig set. After this assembly curation, the primary<lb/> contig assemblies ranged from ~1 to 3 Gb in size, matching the<lb/> expected haploid genome size, with contig N50 values from ~3 to<lb/> 30 Mb in length and 81-88% of the genomes present in phased<lb/> haplotigs (Table <ref type="table">1</ref> and Supplementary Table <ref type="table">1</ref>). Average alternate<lb/> haplotig assembly length, which is equivalent to average phase<lb/> block size, ranged from 188 to 452 kb (Table <ref type="table">1</ref>).<lb/></p>

			<p>In the next stage, Hi-C read pairs were aligned to both the<lb/> collapsed regions and phase blocks using the software BWA-<lb/>MEM <ref type="biblio">24</ref> . By requiring both Hi-C read pairs to have a map quality<lb/> greater than 10, we obtained a haplotype-specific set of Hi-C<lb/> reads. We found that depending on sample heterozygosity level<lb/> (Table <ref type="table">1</ref>), between ~11 and 44% of the Hi-C read pairs contained<lb/> haplotype-specific variants (Supplementary Table <ref type="table">2</ref>). A matrix<lb/> was then generated from the counts of retained Hi-C read pairs<lb/> mapping between phase blocks, and the phasing algorithm was<lb/> then applied. We assessed phasing performance of our method by<lb/> counting parental k-mers identified in Illumina sequence data<lb/> from the parents and used a stringent measure that penalized<lb/> every k-mer that was contained within an erroneous phase switch.<lb/> We ran FALCON-Phase on 64 CPUs, with 488GB RAM, and a<lb/> 600GB magnetic disk. For the mHomSap3 dataset the total wall<lb/> time was 46 h and the total CPU time was 579 h. The majority of<lb/> time was spent mapping the HiC data (549 CPU hours) and<lb/> running the phasing algorithm (25 CPU hours).<lb/></p>

			<p>Before applying FALCON-Phase, ~61-75% of the primary<lb/> contig k-mers and ~95-98% of the haplotig k-mers were<lb/></p>

			<figure>Primary Contig<lb/> Haplotig 1<lb/> Haplotig 2<lb/> Primary Contig<lb/> Haplotig 1<lb/> Haplotig 2<lb/> B<lb/> A<lb/> B<lb/> A<lb/> [0,1]<lb/> [1,0]<lb/> B<lb/> A<lb/> phase block 1<lb/> phase block 2<lb/> B<lb/> A<lb/> a. Partially-phased long read assembly<lb/> b. Haplotig placement<lb/> c. Mincing<lb/> d. Hi-C mapping<lb/> e. Phasing<lb/> f. Emission of pseudohaplotypes with extended-phasing<lb/> Fig. 1 Overview of FALCON-Phase method. a Partially phased long-read assembly consists of primary contigs (blue) and shorter alternate haplotigs (red).<lb/> The region where a haplotig overlaps a primary contig is a phase block and is referred to as being unzipped because two haplotypes are resolved. Regions<lb/> of the primary contig without associated haplotigs are referred to as collapsed because the haplotypes have low or no heterozygosity. b A haplotig<lb/> placement file specifies primary contig coordinates where the haplotigs align. c This placement file is used to mince the primary contigs at the haplotig<lb/> alignment start and end coordinates. Mincing defines the phase blocks (A-B haplotype pairs, blue and red) and collapsed haplotypes (gray). d Hi-C read<lb/> pairs are mapped to the minced contigs and alignments are filtered to retain haplotype-specific mapping. e Phase blocks are assigned to state 0 or 1 using<lb/> the phasing algorithm. f The output of FALCON-Phase is two full-length pseudo-haplotypes for phase 0 and 1. These sequences are of similar length to the<lb/> original primary contig and the unzipped haplotypes are in phase with each other.<lb/></figure>

			<figure type="table">Table 1 Input statistics for the genomes used for FALCON-Phase.<lb/> Sample heterozygosity<lb/> Sample<lb/> Zebra finch Cow<lb/> HG00733<lb/> mHomSap3<lb/> Heterozygosity (%)<lb/> 1.57-1.72<lb/> 0.65-0.93<lb/> 0.17-0.21<lb/> 0.25-0.26<lb/> Contig and Hi-C summary statistics<lb/> Primary assembly length (Gb)<lb/> 1.05<lb/> 2.71<lb/> 2.89<lb/> 2.88<lb/> Primary Contig N50 (Mb)<lb/> 3.48<lb/> 31.4<lb/> 26.3<lb/> 22.4<lb/> Mean Phase Block Length (kb)<lb/> 188<lb/> 452<lb/> 312<lb/> 351<lb/> Proportion of genome unzipped (%)<lb/> 87.6<lb/> 87.7<lb/> 84.0<lb/> 81.1<lb/> Average number of Hi-C links between phase blocks on the same primary contig (pre/post)<lb/> filtering<lb/> 92.5/31.5<lb/> 20.39/4.79 44.79/2.42 16.28/10.10<lb/> Scaffold summary statistics<lb/> Number of scaffolds<lb/> 30<lb/> 31<lb/> 23<lb/> 28<lb/> Total scaffold length (Gb)<lb/> 1.06<lb/> 2.64<lb/> 2.86<lb/> 2.87<lb/> Number of gaps<lb/> 740<lb/> 962<lb/> 523<lb/> 850<lb/> Number of contigs scaffolded<lb/> 797<lb/> 1040<lb/> 514<lb/> 862<lb/> Number of unscaffolded contigs<lb/> 160<lb/> 650<lb/> 351<lb/> 207<lb/></figure>

			<figure>0<lb/> 500,000<lb/> 1,000,000<lb/> 0<lb/> 500,000<lb/> 1,000,000<lb/> Contig Length<lb/> 5,000,000<lb/> 10,000,000<lb/> 15,000,00<lb/> 20,000,000<lb/> Assembly<lb/> haplotigs<lb/> primary<lb/> 0<lb/> 1,000,000<lb/> 2,000,000<lb/> 0<lb/> 1,000,000<lb/> 2,000,000<lb/> Contig Length<lb/> 5,000,000<lb/> 10,000,000<lb/> 15,000,000<lb/> 20,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> a.<lb/> Zebra Finch FALCON-Unzip Contigs<lb/> c.<lb/> Zebra Finch FALCON-Phase Contigs<lb/> 0<lb/> 100,000<lb/> 200,000<lb/> 300,000<lb/> 0<lb/> 100,000<lb/> 200,000<lb/> 300,000<lb/> Contig Length<lb/> 20,000,000<lb/> 40,000,000<lb/> 60,000,000<lb/> 80,000,000<lb/> Assembly<lb/> haplotigs<lb/> primary<lb/> 0<lb/> 100,000<lb/> 200,000<lb/> 300,000<lb/> 0<lb/> 100,000 200,000 300,000<lb/> Contig Length<lb/> 20,000,000<lb/> 40,000,000<lb/> 60,000,000<lb/> 80,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> f.<lb/> HG00733 FALCON-Phase Contigs<lb/> 0<lb/> 1,000,000<lb/> 2,000,000<lb/> 0<lb/> 1,000,000<lb/> 2,000,000<lb/> Contig Length<lb/> 25,000,000<lb/> 50,000,000<lb/> 75,000,000<lb/> Assembly<lb/> haplotigs<lb/> primary<lb/> 0<lb/> 1,000,000<lb/> 2,000,000<lb/> 3,000,000<lb/> 0<lb/> 1,000,000 2,000,000 3,000,000<lb/> Contig Length<lb/> 25,000,000<lb/> 50,000,000<lb/> 75,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> b.<lb/> Cow FALCON-Unzip Contigs<lb/> d. Cow FALCON-Phase Contigs<lb/> e. HG00733 FALCON-Unzip Contigs<lb/> g. mHomSap3 FALCON-Unzip Contigs<lb/> h. mHomSap3 FALCON-Phase Contigs<lb/> 0<lb/> 200,000<lb/> 400,000<lb/> 0<lb/> 200,000<lb/> 400,000<lb/> Maternal k-mers<lb/> Paternal<lb/> k-mers<lb/> Contig Length<lb/> 20,000,000<lb/> 40,000,000<lb/> 60,000,000<lb/> 80,000,000<lb/> Assembly<lb/> haplotigs<lb/> primary<lb/> 0<lb/> 200,000<lb/> 400,000<lb/> 600,000<lb/> 0<lb/> 200,000 400,000 600,000<lb/> Maternal k-mers<lb/> Contig Length<lb/> 20,000,000<lb/> 40,000,000<lb/> 60,000,000<lb/> 80,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> Paternal<lb/> k-mers<lb/> Paternal<lb/> k-mers<lb/> Paternal<lb/> k-mers<lb/> Fig. 2 Phasing accuracy of contigs before (left) and after applying FALCON-Phase (right) to the contigs. Parent-specific k-mer count from mother is on<lb/> the x-axis and father on the y-axis. Contig size is indicated by size of the data point and well-phased contigs lie along the axes. Unphased primary contigs<lb/> (blue) are large but contain a mixture of k-mer markers from mother and father. Haplotigs are mostly phased but shorter in length. After phasing by<lb/> FALCON-Phase, phase 0 and phase 1 contigs are of similar length to the FALCON-Unzip primary contigs and have less mixing of parental markers within<lb/> contigs. a Zebra finch contigs before phasing; b zebra finch contigs after phasing; c cow contigs before phasing; d cow contigs after phasing; e HG00733<lb/> contigs before phasing; f HG00733 contigs after phasing; g mHomSap4 contigs before phasing; h mHomSap3 contigs after phasing.<lb/></figure>

			<p>accurately phased into their paternal or maternal haplotypes<lb/> (Fig. <ref type="figure">2a, c, e, g</ref> and Table <ref type="table">2</ref>; see also ref. <ref type="biblio">25</ref> ). After applying<lb/> FALCON-Phase, the accuracy of the phasing of the new contigs<lb/> was 91-96% for cow, zebra finch, and mHomSap3 (Fig. <ref type="figure">2b, d, f, h<lb/></ref> and Table <ref type="table">2</ref>). The accuracy for the HG00733 human was lower at<lb/> 80.3%, likely due to poor quality Hi-C data (see below for more<lb/> detail). In comparison, trio-binned Canu assemblies have &gt;99%<lb/> parental phasing accuracy for these genomes. We also evaluated<lb/> the phase accuracy of a supernova assembly of the<lb/> HG00733 sample and determined it to be 74% for parental<lb/> haplotypes (Supplementary Fig. <ref type="figure">1</ref>). We also applied FALCON-<lb/>Phase to a PacBio HiFi assembly of HG002 and saw similar<lb/> performance to the other humans (Supplementary Table <ref type="table">3</ref>).<lb/> </p>
				
			<p>The FALCON-Unzip assemblies of the two human samples<lb/> had similar contiguity (primary contig N50 = 22.4 for mHom-<lb/>Sap3 and 26.3 Mb for HG00733), mean phase block length (0.351<lb/> Mb for mHomSap3 and 0.312 Mb for HG00733), and percent of<lb/> the genome unzipped (81% for mHomSap3 and 84% for<lb/> HG00733; Table <ref type="table">1</ref>), although the heterozygosity for mHomSap3<lb/> is slightly higher than for HG00733 (0.26% versus 0.21%).<lb/> Interestingly, both the absolute number and percentage of long-<lb/>range Hi-C contacts for mHomSap3 are much higher than that of<lb/> HG00733: 12M versus 4.5M Hi-C read pairs have mapping<lb/> distance greater than 100 kb (6.6% versus 3.5% of filtered reads<lb/> have &gt;100 kb mapping distance, Supplementary Table <ref type="table">3</ref> and<lb/> Supplementary Fig. <ref type="figure">2</ref>). A possible explanation for the poorer Hi-<lb/>C data of HG00733 is that it was collected from a frozen cell line<lb/> whereas the mHomSap3 Hi-C data were collected from<lb/> fresh blood.<lb/></p>

			<head>Over 85% of paternal and maternal scaffolds correctly phased.<lb/></head>

			<p>One set of the resulting contigs from FALCON-Phase (phase 0)<lb/> was scaffolded into chromosome-scale sequences using Proximo<lb/> Hi-C (Phase Genomics, Table <ref type="table">1</ref> and Fig. <ref type="figure">3</ref>). A second round of<lb/> phasing was performed on the scaffolds using FALCON-Phase<lb/> and performance was evaluated using parental k-mer counts in<lb/> the unphased versus phased scaffolds (Table <ref type="table">2</ref>). We compare the<lb/> phasing accuracy of the scaffolds before running FALCON-Phase<lb/> as a baseline to assess performance for the second round of<lb/> phasing. In the non-human samples, the unphased scaffolds had<lb/> between ~62% (zebra finch) and ~78% (cow) phasing accuracy<lb/> (Table <ref type="table">2</ref>); after the second round of FALCON-Phase, accuracy<lb/> increased to ~88% and ~92%, respectively (Table <ref type="table">2</ref>). For the<lb/> human samples, unphased scaffolds had ~63% (HG00733) and<lb/> ~78% (mHomSap3) phasing accuracy. Phasing performance in<lb/> mHomSap3 was good (85% accuracy), compared to HG00733<lb/> (74%), which had similarly bad performance for contig phasing<lb/> due to the poor quality of the Hi-C data (see above). It is<lb/> important to note that, unlike trio binning, additional informa-<lb/>tion is necessary to compile the maternal or paternal scaffold sets<lb/> as the phase 0 and phase 1 scaffolds are a mix of maternal and<lb/> paternal scaffolds. Also, sex chromosomes and other hemizygous<lb/> sequence should be treated separately from autosomes.<lb/></p>

			<p>To independently verify the parental phasing and structural<lb/> correctness of our human scaffolds, we compared FALCON-<lb/>Phase HG0733 scaffolds to Strand-seq data from the same<lb/> individual. Only a small fraction of total length of FALCON-<lb/>Phase scaffolds genotyped discordantly as homozygous (~0.6%)<lb/> or heterozygous (~1.6%) (Supplementary Fig. <ref type="figure">3</ref>). There were 10<lb/> putative misassembles at the contig level, which is a commonly<lb/> observed number for FALCON-or Peregrine-based <ref type="biblio">26</ref> assemblies<lb/> when compared to Strand-seq data <ref type="biblio">27</ref> . The scaffolds had a phasing<lb/> switch error rate of 0.78 and a hamming distance of 36%<lb/> (Supplementary Table <ref type="table">4</ref>). The hamming distance reported<lb/> correlates well with the 74% phasing accuracy measured by our<lb/> k-mer counting approach for HG00733. Unfortunately, Strand-<lb/>seq data were not available for the samples with high-quality Hi-<lb/>C data so we could not assess them in the same way.<lb/></p>

			<p>We also explored the performance of our method in the highly<lb/> heterozygous and repetitive major histocompatibility complex<lb/> (MHC) region in the mHomSap3 dataset. We identified<lb/> haplotype phase blocks using Merqury <ref type="biblio">28</ref> in the chromosome<lb/> 6 scaffold before and after running FALCON-Phase (Supple-<lb/>mentary Fig. <ref type="figure">4</ref>). Phase blocks were large in the unphased<lb/> scaffolds: two phase blocks spanned the 4 Mb region around the<lb/> MHC with a switch between paternal and maternal haplotype<lb/> near the C4A gene. FALCON-Phase corrected this phase switch,<lb/> and the final sequence contained only a short segment of paternal<lb/> haplotype (50 kb) in an otherwise maternal phase block. This<lb/> phasing error overlaps a putative structural error in our assembly,<lb/> nested in an array of segmental duplications with greater than<lb/> 99% sequence identity (Supplementary Fig. <ref type="figure">4</ref>). Additional<lb/> orthogonal data are necessary to resolve the discrepancy between<lb/> our assembly and the hg38 reference.<lb/></p>

			<head>Discussion<lb/></head>

			<p>The ultimate goal of genome assembly is to faithfully represent<lb/> each chromosome in the organism from telomere-to-telomere. To<lb/> do so, assembly methods must account for sequence divergence<lb/> between homologous maternal and paternal chromosomes in<lb/> order to prevent collapsed haplotypes and false sequence dupli-<lb/>cations, which may result in incomplete or erroneous repre-<lb/>sentations of the underlying biological sequence <ref type="biblio">7,9,29</ref> . Long-read<lb/> genome assemblers like FALCON-Unzip identify heterozygous<lb/> regions of a genome as bubbles in assembly graphs and unzip<lb/> those bubbles further by phasing and reassembling reads using<lb/> single-nucleotide variants (SNVs) <ref type="biblio">16</ref> . However, long-read assem-<lb/>blers cannot phase entire primary contigs. To address this lim-<lb/>itation, we designed FALCON-Phase, which uses Hi-C data to<lb/> extend the phase blocks to the contig and scaffold scales. Here, we<lb/> have demonstrated that FALCON-Phase improves accuracy for<lb/> heterozygous diploid genome assemblies, without the need for<lb/> parental, population, or Strand-seq data.<lb/></p>

			<figure type="table">Table 2 FALCON-Phase performance.<lb/> Contig phasing accuracy<lb/> Sample<lb/> Zebra finch<lb/> Cow<lb/> HG00733<lb/> mHomSap3<lb/> FALCON-Unzip Primary Contig Accuracy (%)<lb/> 70.8<lb/> 71.0<lb/> 61.0<lb/> 75.5<lb/> FALCON-Unzip Haplotig Accuracy (%)<lb/> 94.9<lb/> 98.7<lb/> 96.2<lb/> 98.3<lb/> FALCON-Phase Contig Accuracy (%)<lb/> 91.2<lb/> 96.0<lb/> 80.3<lb/> 91.2<lb/> Trio-binned Canu Contig Accuracy (%)<lb/> 99.4<lb/> 99.4<lb/> 99.5<lb/> 99.6<lb/> Scaffold phasing accuracy<lb/> Unphased Scaffold Accuracy (%)<lb/> 64.1<lb/> 77.8<lb/> 62.9<lb/> 75.7<lb/> FALCON-Phase Scaffold Accuracy (%)<lb/> 88.4<lb/> 92.4<lb/> 73.9<lb/> 84.9<lb/></figure>

			<p>FALCON-Phase, in conjunction with long-read assembly, is<lb/> thus an attractive method for generating high-quality reference<lb/> genomes of samples for which parents are not available. This<lb/> approach should be useful for large-scale genome initiatives that<lb/> source samples of diverse origins, including invertebrate disease<lb/> vectors, agricultural pests, or threatened or endangered wild-<lb/>caught individuals. The method utilizes two technologies<lb/> common in generating highly contiguous genome assemblies:<lb/> PacBio long reads and Hi-C. While Hi-C is commonly used for<lb/> scaffolding <ref type="biblio">30,31</ref> , our study finds that similar high-quality data can<lb/> also be used for contig or scaffold phasing. The accuracy of<lb/> phasing increases with Hi-C data quality, specifically the pro-<lb/>portion of long-range contacts greater than 100-kb. Coverage<lb/> requirements of Hi-C for phasing are similar to scaffolding, 100<lb/></p>

			<figure>0<lb/> 5,000,000<lb/> 15,000,000<lb/> 0<lb/> 5,000,000<lb/> 15,000,000<lb/> Scaffold Length<lb/> 50,000,000<lb/> 100,000,000<lb/> 150,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> 0<lb/> 2,500,000<lb/> 5,000,000<lb/> 7,500,000<lb/> 0<lb/> 2,500,000 5,000,000 7,500,000<lb/> Scaffold Length<lb/> 30,000,000<lb/> 60,000,000<lb/> 90,000,000<lb/> Assembly<lb/> scaffolds<lb/> Zebra Finch Unphased Scaffolds<lb/> Zebra Finch Phased Scaffolds<lb/> 0<lb/> 2,000,000<lb/> 4,000,000<lb/> 0<lb/> 2,000,000<lb/> 4,000,000<lb/> Scaffold Length<lb/> 40,000,000<lb/> 80,000,000<lb/> 120,000,000<lb/> 160,000,000<lb/> Assembly<lb/> scaffolds<lb/> 0<lb/> 2,000,000<lb/> 4,000,000<lb/> 0<lb/> 2,000,000<lb/> 4,000,000<lb/> Scaffold Length<lb/> 40,000,000<lb/> 80,000,000<lb/> 120,000,000<lb/> 160,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> a.<lb/> Cow Unphased Scaffolds<lb/> Cow Phased Scaffolds<lb/> b.<lb/> c.<lb/> d.<lb/> 0<lb/> 250,000<lb/> 500,000<lb/> 750,000<lb/> 0<lb/> 250,000<lb/> 500,000<lb/> 750,000<lb/> Scaffold Length<lb/> 50,000,000<lb/> 100,000,000<lb/> 150,000,000<lb/> 200,000,000<lb/> Assembly<lb/> scaffolds<lb/> 0<lb/> 300,000<lb/> 600,000<lb/> 900,000<lb/> 0<lb/> 300,000 600,000 900,000<lb/> Scaffold Length<lb/> 50,000,000<lb/> 100,000,000<lb/> 150,000,000<lb/> 200,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> HG00733 Unphased Scaffolds<lb/> HG00733 Phased Scaffolds<lb/> e.<lb/> f.<lb/> mHomSap3 Unphased Scaffolds<lb/> mHomSap3 Phased Scaffolds<lb/> g.<lb/> h.<lb/> 0<lb/> 500,000<lb/> 1,000,000<lb/> 0<lb/> 5 0 0 , 0 0 0<lb/> 1,000,000<lb/> Contig Length<lb/> 50,000,000<lb/> 100,000,000<lb/> 150,000,000<lb/> 200,000,000<lb/> Assembly<lb/> phase0<lb/> phase1<lb/> 0<lb/> 500,000<lb/> 1,000,000<lb/> 1,500,000<lb/> 0<lb/> 500,000<lb/> 1,000,000<lb/> Maternal k-mers<lb/> Paternal<lb/> k-mers<lb/> Contig Length<lb/> 50,000,000<lb/> 100,000,000<lb/> 150,000,000<lb/> 200,000,000<lb/> Assembly<lb/> scaffolds<lb/> 1,500,000<lb/> Maternal k-mers<lb/> Paternal<lb/> k-mers<lb/> Paternal<lb/> k-mers<lb/> Paternal<lb/> k-mers<lb/> Fig. 3 Phasing accuracy of scaffolds before (left) and after applying FALCON-Phase (right). Parent-specific k-mers from mother are on the x-axis and<lb/> father on the y-axis. Scaffold size is indicated by size of the data point and well-phased contigs lie along the axes. Only the phase 0 contigs from FALCON-<lb/>Phase were scaffolded. Scaffolds after a second round of phasing by FALCON-Phase show greater separation, indicating each scaffold contains a higher<lb/> proportion of markers from one parent. a Zebra finch scaffolds before phasing; b zebra finch scaffolds after phasing; c cow scaffolds before phasing; d cow<lb/> scaffolds after phasing; e HG00733 scaffolds before phasing; f HG00733 scaffolds after phasing; g mHomSap4 scaffolds before phasing; h<lb/> mHomSap3 scaffolds after phasing.<lb/></figure>

			<p>M reads per Gb of genome size and coverage recommendations<lb/> for PacBio long reads is at least 60-fold coverage and for PacBio<lb/> HiFi reads 30-fold coverage. A feature of FALCON-Phase is that<lb/> it can also be applied to scaffolds in order to link phased scaffold<lb/> regions. Thus, we suggest the following genome assembly work-<lb/>flow: (1) partially phased long-read assembly, (2) FALCON-Phase<lb/> on primary contigs and haplotigs, (3) scaffolding with Hi-C data,<lb/> and (4) FALCON-Phase on scaffolds.<lb/></p>

			<p>FALCON-Phase relies on a diploid assembly that is curated as<lb/> a haploid set of primary contigs plus alternate haplotigs that are<lb/> each assigned to a primary contig. Generating a high-quality<lb/> assembly requires the removal of chimeric contigs that join<lb/> unlinked loci <ref type="biblio">22,31</ref> in the primary assembly using tools, such as<lb/> purge haplotigs <ref type="biblio">32</ref> , or purge_dups <ref type="biblio">33</ref> . Any primary contig is treated<lb/> as if it were diploid and will be duplicated in the pseudo-<lb/>haplotype output. Contigs from hemizygous regions of the gen-<lb/>ome, such as the non-pseudoautosomal regions of sex chromo-<lb/>somes and mitochondrial sequences (i.e., haploid), cannot have<lb/> phase-switch errors and should be removed prior to running<lb/> FALCON-Phase or they will be duplicated as an artifact of the<lb/> method.<lb/></p>

			<p>The phasing algorithm at the core of FALCON-Phase could be<lb/> adapted to use other long-range contact data types and higher<lb/> ploidies. The input matrix is simply a count of contacts between<lb/> all pairs of sequences in an assembly. Instead of Hi-C data, BAC-<lb/>end sequences, read clouds/linked-reads, or optical maps could be<lb/> transformed into the required input for FALCON-Phase. Hi-C<lb/> was chosen over the other technologies because it provides ultra-<lb/>range contact information (&gt;1 Mb), which enables chromosome-<lb/>scale phase blocks to be created. Similarly, the input sequences<lb/> could consist of phase blocks generated through resequencing and<lb/> variant calling, or pseudo-haplotypes generated from assemblies<lb/> of PacBio HiFi reads or Oxford Nanopore reads (see Supple-<lb/>mentary Table <ref type="table">3</ref> where we apply the method to a PacBio HiFi<lb/> assembly of HG002). The simple approach of skirting variant<lb/> calling reduces the number of steps and overall runtime of<lb/> phasing pseudo-diploid assemblies. There are additional finishing<lb/> steps before the assembly is ready for genome annotation, e.g.,<lb/> gap filling with a tool such as PB Jelly <ref type="biblio">34</ref> . For these reasons, we<lb/> believe FALCON-Phase will be an important algorithmic con-<lb/>tribution to the goal of diploid, high-quality genome assemblies.<lb/></p>

			<head>Methods<lb/></head>

			<head>FALCON-Phase method. </head>

			<p>FALCON-Phase has three stages: (1) processing partially<lb/> phased contigs and Hi-C data; (2) application of the phasing algorithm; and (3)<lb/> emission of phased pseudo-haplotypes (Fig. <ref type="figure">1</ref>). We implemented FALCON-Phase<lb/> using the Snakemake language to provide flexibility and pipeline robustness <ref type="biblio">35</ref> . The<lb/> pipeline can be run interactively, on a single computer, or submitted to a cluster job<lb/> scheduler. The code is open source under a Clear BSD plus attribution license and<lb/> is available through github (https://github.com/phasegenomics/FALCON-Phase).<lb/></p>

			<p>In stage one, the contigs are processed to identify phase blocks: regions of the<lb/> genome that have been unzipped into a maternal and paternal pair of haplotypes.<lb/> For example, FALCON-Unzip generates contiguous primary contigs representing<lb/> pseudo-haplotypes and shorter phased alternate haplotigs. A haplotig placement<lb/> file is generated in the pairwise alignment format <ref type="biblio">36</ref> that specifies the alignment<lb/> location of each haplotig on the primary contig (Fig. <ref type="figure">1</ref>). Briefly, haplotigs are<lb/> aligned, filtered, and processed with three utilities of the mummer v4 package:<lb/> nucmer, delta-filter, and show-coords <ref type="biblio">37</ref> . Sub-alignments for each haplotig are<lb/> chained in one dimension to find the optimal start and end of the placement using<lb/> the coords2hp.py script. Finally, non-unique haplotig mappings and those fully<lb/> contained by other haplotigs are removed with filt_hp.py.<lb/></p>

			<p>The haplotig placement file is used to generate three minced FASTA files<lb/> (Fig. <ref type="figure">1</ref>), A_haplotigs.fasta, B_haplotigs.fasta, and collapsed_haplotypes.fasta. The A<lb/> haplotigs are the original haplotigs (red in Fig. <ref type="figure">1</ref>), the B haplotigs are the<lb/> corresponding homologous region of the primary contigs (the alternate haplotype,<lb/> blue in Fig. <ref type="figure">1c, d</ref>), and the collapsed haplotypes are the unphased or collapsed<lb/> regions of the assembly (gray in Fig. <ref type="figure">1</ref>). The pairing of the A and B minced<lb/> haplotigs in the phase blocks and their order along the primary contig is<lb/> summarized in an index file, ov_index.txt generated by primary_contig_index.pl.<lb/></p>

			<p>The Hi-C reads are mapped to the minced contigs using BWA-MEM, with the<lb/> Hi-C option (-5) enabled <ref type="biblio">24</ref> . The mapped reads are streamed to SAMtools,<lb/> removing unmapped, secondary, and supplementary alignments (SAMtools -F<lb/> 2316) <ref type="biblio">38</ref> . This operation ensures that each mate-pair only contains two alignment<lb/> records. In the last step of read processing, a map quality score filter of Q10 (for<lb/> both reads) is applied, removing reads without haplotype-specific sequence.<lb/> Additionally, we set an edit distance from the reference of less than 5 for both<lb/> reads. Both more stringent (60) and relaxed (0) map quality filtering resulted in<lb/> lower phasing accuracy.<lb/></p>

			<p>The Hi-C mate-pair counts between minced contigs are enumerated into a<lb/> contact matrix, M. Each element, M i,j , in the matrix is later normalized by the<lb/> number of Hi-C restriction enzyme sites, z, in both the ith and jth minced contigs<lb/> as shown in Eq. (<ref type="formula">1</ref>). The raw count matrix is encoded into a binary matrix format.<lb/></p>

				<formula>Mi;j :¼<lb/> M i;j<lb/> z i þ z j<lb/> <label>ð1Þ<lb/></label></formula>



			<p>We designed an algorithm to extend phasing between haplotig phase blocks<lb/> based on Hi-C read pair mapping. The algorithm searches for the optimum set of<lb/> phase block configurations along a primary contig using a stochastic model. The<lb/> algorithm is given a list, C, of tuples for the phase blocks and their sequential<lb/> ordering along each primary contig. During initialization, each member of the<lb/> phase block, except the first, is randomly assigned one of the two possible phase<lb/> configurations for a diploid organism ∈({[0, 1],[1, 0]}). The phase assignment is<lb/> stored in array T where 0 corresponds to phase configuration [0, 1]. The first phase<lb/> block along the primary contig is always assigned to the phase configuration [0, 1]<lb/> as its orientation is arbitrary. By fixing the first phase block, the search results are<lb/> comparable across iterations. Phase blocks are only randomly initialized once<lb/> before the search begins. The algorithm sweeps along the phase blocks of each<lb/> primary contig, assigning a phase for the blocks, conditioned on the phase<lb/> assignment of all previous phase blocks and the Hi-C links between them. The<lb/> phaseFreq function (Eq. 2) calculates the frequency of Hi-C links from the current<lb/> region, i, to all past regions, j, that have the same phase, i.e.,</p>

				<formula>T i = T j = 1 = [1, 0].<lb/> phaseFreqði; T; M; CÞ ¼<lb/> P j&lt;i<lb/> j¼0 γ i; j<lb/> ð Þ*αði; jÞ<lb/> P j&lt;i<lb/> j¼0 βði; jÞ<lb/> <label>ð2Þ<lb/></label></formula>



			<p>The phaseFreq function takes the index of the current phase block, i, the phase<lb/> assignment of all regions associated with a given primary contig, array T, the<lb/> normalized Hi-C count matrix, M, and the C array of the phase block tuples. The<lb/> gamma function (Eq. 3) determines if two phase blocks have the same phase<lb/> assignment, T, and if so returns 1. The alpha function (Eq. 4) gives the normalized<lb/> cis counts of Hi-C links between a pair of phase blocks whereas the beta function<lb/> (Eq. 5) returns both the cis and trans counts, which is a normalizing constant.<lb/></p>

				<formula>γ i; j<lb/> ð Þ ¼<lb/> 1; T i<lb/> ½ ¼ T½j<lb/> 0; T i<lb/> ½ ≠ T½j<lb/> &amp;<lb/> <label>ð3Þ<lb/></label></formula>



				<formula>α i; j; M; C<lb/> À<lb/> Á<lb/> ¼ M C i; 0<lb/> ½ ; C j; 1<lb/> ½<lb/> ½<lb/> þ M C i; 1<lb/> ½ ; C j; 0<lb/> ½<lb/> ½<lb/> <label>ð4Þ<lb/></label></formula>



				<formula>β i; j; M; C<lb/> À<lb/> Á<lb/> ¼ M C i; 0<lb/> ½ ; C j; 0<lb/> ½<lb/> ½<lb/> þ M C i; 1<lb/> ½ ; C j; 1<lb/> ½<lb/> ½<lb/> þ M C i; 0<lb/> ½ ; C j; 1<lb/> ½<lb/> ½<lb/> þ M C i; 1<lb/> ½ ; C j; 0<lb/> ½<lb/> ½<lb/> <label>ð5Þ<lb/></label></formula>



			<p>The process of phase assignment across a primary contig is iterated for a burn-<lb/>in period followed by a scoring period (see <ref type="biblio">Algorithm 1)</ref>. The only difference<lb/> between the two stages is that the scoring stage enumerates the number of<lb/> iterations that each member of the phase block spends in phase 1 <ref type="biblio">[1, 0]</ref>. We found<lb/> by ignoring several million iterative sweeps over a primary contig, the algorithm<lb/> tends to be in a more favorable search space. The final phase assignment is the<lb/> configuration in which each member of a phase block spent the most iterations. In<lb/> practice, 50-100 M iterations with 10 M burn-in period generated consistent<lb/> results. The limiting computational resource is memory as ( M) is not sparse.<lb/></p>

			<head>Algorithm 1.<lb/></head>

			<p>Phasing procedure<lb/> Data: normalized HiC count matrix ( M), contig overlap index array (C), number of<lb/> permutations (n) and burn in (b)<lb/> Result: (R) array, the phase of the A-B haplotig pairs is ε {0,1}<lb/> m ← length of C-1<lb/> R ≡ result array of length of C<lb/> T ≡ temporary phase array of length of C<lb/> P ≡ state count array (T[i] = 1) of length C<lb/> if length of C ==1 then<lb/> return R[0] ← random (ε {0.1})<lb/> end<lb/> for j ← 0 to m do<lb/> R[j] ← T[j] ← random (ε{0.1})<lb/> P[j] ← 0;<lb/> end<lb/> for i ← 0 to n do<lb/> for j ← 0 to m do<lb/> T[j] ← 1;<lb/> if phaseFreq (j, T, M, C) &lt; runif (⬚) then<lb/> T[j] ← 0;<lb/> end<lb/> if i &gt; band T[j] = 1 then<lb/> P[j] ← P[j] + 1<lb/> end<lb/> end<lb/> end<lb/> for j ← 0 to m do<lb/> R[j] ← 1;<lb/> if P j<lb/> ½<lb/> ðnÀbÞ &lt; 0:5 then<lb/> R[j] ← 0;<lb/> end<lb/> end<lb/> Return R<lb/></p>

			<p>Once the phase assignments of haplotype pairs in the phase blocks are<lb/> determined, the minced fasta sequences are joined into two full-length<lb/> pseudo-haplotypes (phase 0 and phase 1) per primary contig (Fig. <ref type="figure">1</ref>). The<lb/> order of minced sequences (phase blocks plus collapsed regions) is determined<lb/> by the haplotig placement file and the phase assignment is determined by the<lb/> phasing algorithm. An alternate output similar to the FALCON-Unzip format<lb/> of primary contigs and haplotigs is also available as a user-specified option.<lb/> Users can specify pseudo-haplotype or unzip output formats, the former<lb/> having the same collapsed sequence in both pseudo-haplotypes, the latter<lb/> matching the FALCON-Unzip assembly output format (primary contigs plus<lb/> haplotigs).<lb/></p>

			<p>We scaffolded the contigs from FALCON-Phase for the non-human datasets<lb/> using default Proximo <ref type="biblio">30,39</ref> settings (Phase Genomics, WA). Briefly, reads were<lb/> aligned to phase 0 pseudo-haplotypes using BWA-MEM <ref type="biblio">40</ref> (v. 0.7.15-r1144-<lb/>dirty) with the -5SP and -t 8 options. SAMBLASTER <ref type="biblio">41</ref> (commit<lb/> 37142b37e4f0026e1b83ca3f1545d1807ef77617) was used to flag PCR duplicates,<lb/> which were later excluded from analysis. Alignments were then filtered with<lb/> SAMtools (v1.5, with htslib 1.5) using the -F 2304 filtering flag to remove non-<lb/>primary and supplementary alignments, as well as read pairs in which one or<lb/> more mates were unmapped. The Phase Genomics Proximo Hi-C genome<lb/> scaffolding platform (commit 145c01be162be85c060c567d576bb4786496c032)<lb/> was used to create chromosome-scale scaffolds from the draft assembly as<lb/> previously described <ref type="biblio">39</ref> . As in the LACHESIS method <ref type="biblio">30</ref> , this process computes a<lb/> contact frequency matrix from the aligned Hi-C read pairs, normalized by the<lb/> number of restriction sites on each contig, and constructs scaffolds in such a way<lb/> as to optimize expected contact frequency and other statistical patterns in Hi-C<lb/> data. Juicebox v1.8.8 was used to correct scaffolding errors <ref type="biblio">22,42</ref> . After<lb/> scaffolding, we applied the phasing algorithm a second time, using as input the<lb/> pairing of the phase 0 and phase 1 pseudo-haplotypes and their order along the<lb/> chromosomes as determined by scaffolding.<lb/></p>

			<p>We evaluated FALCON-Phase on three vertebrate species with different levels<lb/> of heterozygosity: The VGP zebra finch female trio (T. guttata, high); the male<lb/> bovine trio (B. taurus taurus × B. taurus indicus moderate); Puerto Rican human<lb/> female trio, (HG00733, low); the VGP admixed human male trio (mHomSap3,<lb/> low). For each genome, we had high-coverage PacBio CLR data for de novo<lb/> genome assembly, Hi-C data for phasing and scaffolding, paired-end Illumina data<lb/> from the parents, and trio-binned Canu assemblies (see &quot;Data availability&quot;).<lb/></p>

			<p>Heterozygosity was estimated two ways. First, from k-mers (k-length sequence)<lb/> in Illumina whole-genome sequencing reads (see &quot;Data availability&quot;). Fastq files<lb/> were converted to fasta files, then the canonical k-mers were collected using meryl<lb/> in canu 1.7 (ref. <ref type="biblio">9</ref> ) to include all the high frequency k-mers using the<lb/> following code.<lb/> meryl -B -C -s $name.fa -m $k_size -o $name.$k<lb/> meryl -Dh -s $name.$k &gt; $name.$k.hist<lb/> </p>
				
			<p>Given the k-mer histogram, Genomescope <ref type="biblio">43</ref> was used to estimate the level of<lb/> heterozygosity. k = 21 was used for HG00733 and cow, and k = 31 was used for the<lb/> zebra finch and mHomSap3. A higher k-mer size was used for zebra finch for more<lb/> accurate estimates of heterozygosity due to its higher level of polymorphism. This<lb/> k-mer size was also used for other samples in the VGP, from which this sample was<lb/> selected. Second, with mummer v 3.2.3 (ref. <ref type="biblio">44</ref> ), trio-binned parental Canu<lb/> assemblies were aligned with nucmer (nucmer -l 100 -c 500 -maxmatch mom.fasta<lb/> dad.fasta) and heterozygosity was computed as 1-average identity from 1 to 1<lb/> alignments output by dnadiff using default parameters.<lb/></p>

			<p>As a precursor to FALCON-Phase, we performed de novo genome assembly<lb/> with FALCON-Unzip <ref type="biblio">16</ref> using pb-assembly from pbbioconda (v 0.0.6 for<lb/> mHomSap3, v 0.0.2 for zebra finch and cow) and a binary build from13 August<lb/> 2018, for HG00733.<lb/></p>

			<p>Zebra finch parameters: (length_cutoff = 13,653; length_cutoff_pr = 5000;<lb/> pa_daligner_option = -e0.76 -l2,000 -k18 -h70 -w8 -s100; ovlp_daligner_option<lb/> = -k24 -h1024 -e.95 -l1800 -s100; pa_HPCdaligner_option = -v -B128 -M24;<lb/> ovlp_HPCdaligner_option = -v -B128 -M24; pa_HPCTANmask_option = -k18<lb/> -h480 -w8 -e.8 -s100; pa_HPCREPmask_option = -k18 -h480 -w8 -e.8 -s100;<lb/> pa_DBsplit_option = -x500 -s400; ovlp_DBsplit_option = -s400;<lb/> falcon_sense_option =-output-multi-min-idt 0.70-min-cov 2-max-n-read 400-n-<lb/>core 24; overlap_filtering_setting =-max-diff 100-max-cov 150-min-cov 2-n-<lb/>core 24)<lb/></p>

			<p>Cow parameters: (length_cutoff = 14,850; length_cutoff_pr = 12000;<lb/> pa_daligner_option = -e0.76 -l1200 -k18 -h480 -w8 -s100; ovlp_daligner_option<lb/> = -k24 -h480 -e.95 -l1800 -s100; pa_HPCdaligner_option = -v -B128 -M24;<lb/> ovlp_HPCdaligner_option = -v -B128 -M24; pa_HPCTANmask_option = -k18<lb/> -h480 -w8 -e.8 -s100; pa_HPCREPmask_option = -k18 -h480 -w8 -e.8 -s100;<lb/> pa_DBsplit_option = -x500 -s400; ovlp_DBsplit_option = -s400;<lb/> falcon_sense_option = -output_multi-min_idt 0.70-min_cov 4-max_n_read<lb/> 200-n_core 24; overlap_filtering_setting = -max_diff 120-max_cov 120-min_cov<lb/> 4-n_core 24)<lb/></p>

			<p>mHomSap3 parameters: (length_cutoff = 20,375; length_cutoff_pr = 10,000;<lb/> pa_daligner_option = -k18 -e0.8 -l1000 -h256 -w8 -s100; ovlp_daligner_option<lb/> = -k24 -e.92 -l1000 -h1024 -s100; pa_HPCdaligner_option = -v -B128 -M24;<lb/> ovlp_HPCdaligner_option = -v -B128 -M24; pa_HPCTANmask_option = -k18<lb/> -h480 -w8 -e.8 -s100; pa_HPCREPmask_option = -k18 -h480 -w8 -e.8 -s100;<lb/> pa_DBsplit_option = -x500 -s400; ovlp_DBsplit_option = -s400;<lb/> falcon_sense_option =-output-multi-min-idt 0.70-min-cov 3-max-n-read 100-n-<lb/>core 4; falcon_sense_skip_contained = False; overlap_filtering_setting = -max-diff<lb/> 60-max-cov 60-min-cov 2-n-core 12).<lb/></p>

			<p>HG00733 parameters: (length_cutoff = 5000; length_cutoff_pr = 10,000;<lb/> pa_daligner_option = -k18 -e0.75 -l1200 -h256 -w8 -s100; ovlp_daligner_option<lb/> = -k24 -e.92 -l1800 -h600 -s100; pa_HPCdaligner_option = -v -B128 -M24;<lb/> ovlp_HPCdaligner_option = -v -B128 -M24; pa_HPCTANmask_option = -k18<lb/> -h480 -w8 -e.8 -s100; pa_HPCREPmask_option = -k18 -h480 -w8 -e.8 -s100;<lb/> pa_DBsplit_option = -x500 -s400; ovlp_DBsplit_option = -s400;<lb/> falcon_sense_option =-output-multi-min-idt 0.70-min-cov 4-max-n-read 200-n-<lb/>core 8; falcon_sense_skip_contained = False; overlap_filtering_setting =-max-diff<lb/> 60-max-cov 60-min-cov 1-n-core 12).<lb/></p>

			<p>We identified and corrected chimeric contigs between nonadjacent genomic<lb/> regions in HG00733, mHomSap, and cow assemblies using Juicebox Assembly<lb/> Tools <ref type="biblio">22</ref> and D-GENIES <ref type="biblio">45</ref> . We interrogated the concordance of the Hi-C data with<lb/> the PGA scaffolds visually in JBAT. Off-diagonal signals in the heatmap of Hi-C<lb/> read density are indicative of contig/scaffolding errors. Human and cow contigs<lb/> and scaffolds with discordant Hi-C signals were aligned, using minimap2 with the<lb/> -x asm5 setting, to the human or cow reference genomes. If the contig/scaffold in<lb/> question mapped chimerically (inter-or intra-chromosomally) to each genome,<lb/> they were flagged. We manually broke these contigs between phase blocks and<lb/> reassociated the haplotigs to the two new contigs.<lb/></p>

			<p>To remove duplicated haplotypes in the primary contigs from the zebra finch<lb/> FALCON-Unzip assembly, as suggested for highly heterozygous genomes from the<lb/> VGP <ref type="biblio">46</ref> , we ran purge haplotigs <ref type="biblio">23</ref> on zebra finch using default settings and coverage<lb/> estimates from PacBio subreads mapped to the primary contigs <ref type="biblio">23</ref> . We<lb/> recategorized 67.1 Mb of primary contigs as haplotigs (N = 632) and 25.4 Mb of<lb/> repetitive sequences (N = 329) were discarded.<lb/></p>

			<p>To evaluate phase assignment, parent-specific k-mers were counted in the<lb/> pseudo-haplotypes before and after contig phasing, before and after scaffold<lb/> phasing, and in trio-binned Canu assemblies. Parental k-mers were identified using<lb/> Illumina data from the parents 9 using k = 21. Parental k-mers were counted in the<lb/> assemblies using the simple-dump utility from Canu v1.7. The proportion of<lb/> correct parental k-mers was used as an overall measure of contig or scaffold<lb/> phasing and was plotted for each contig or scaffold in Fig. <ref type="figure">2</ref>.<lb/></p>

			<p>To evaluate the structural contiguity of FALCON-Phase scaffolds we aligned<lb/> available Strand-seq data <ref type="biblio">47</ref> to the HG00733 scaffolds. We used breakpointR <ref type="biblio">48</ref> in<lb/> order to detect regions that are consistently genotyped as &quot;HOM&quot; (majority of<lb/> reads in minus direction) or &quot;HET&quot; (mixture of plus and minus reads) across all<lb/> Strand-seq libraries. Regions genotyped as HOM suggest a homozygous inversion<lb/> or misorientation, while regions genotyped as HET points to either a heterozygous<lb/> inversion, chimerism, or collapsed repetitive region. Phasing accuracy was<lb/> evaluated using SNVs detected based on alignments of contig stage assemblies to<lb/> GRCh38 using minimap2 (version 2.17). We evaluate phasing accuracy of our<lb/> assemblies in comparison to trio-based phasing for HG00733 (ref. <ref type="biblio">47</ref> ). We compare<lb/> only SNV positions that are shared between phased assemblies and those from trio-<lb/>based phasing. Then the switch error rate and Hamming distance were calculated<lb/> as described in Porubsky et al. <ref type="biblio">49</ref> .</p>


	</text>
</tei>